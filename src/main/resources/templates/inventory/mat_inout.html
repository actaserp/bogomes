<html layout:decorate="~{layout_page}">
<head>
    <style>
        .greenText {
            color: #66DA26;
        }

        .redText {
            color: #FF0000;
        }

        .blueText {
            color: #4374D9;
        }

        .select2-container--open {
            z-index: 9001;
        }

        .grid-cell-red {
            background: #f8d2cb;
        }

        .grid-cell-blue {
            background: #dcf0f8;
        }

        .grid-cell-white {
            background: #ffffff;
        }

        .search-flex-row {
            display: flex;
            justify-content: space-between; /* Ï¢å: Í≤ÄÏÉâÌïÑÎìú / Ïö∞: Î≤ÑÌäº */
            align-items: flex-end;          /* ÌïòÎã® Ï†ïÎ†¨ ÎßûÏ∂îÍ∏∞ */
            width: 100%;
            gap: 16px;
        }


        @media (max-width: 1366px) {

            /*.write-table input, .write-table select{*/
            /*    width: 280px;*/
            /*}*/

            .write-table textarea {
                height: 80px;
            }

        }

        .wj-header {
            text-align: center !important;
        }

        .input-with-button {
            display: flex;
            gap: 4px; /* Î≤ÑÌäºÍ≥º input ÏÇ¨Ïù¥ Ïó¨Î∞± */
            align-items: center;
        }

        .input-with-button input {
            flex: 1; /* ÎÇòÎ®∏ÏßÄ ÏòÅÏó≠ Ï∞®ÏßÄ */
            min-width: 0;
            padding: 4px;
        }

        .input-with-button .btn.in_btn {
            flex-shrink: 0;
            width: 40px;
        }

        .input-with-button button img, .btn img {
            margin-right: 1px;
        }

    </style>
    <style id="print_css">
        @media print {
            .pagebreak {
                page-break-before: always;
            }

            /* page-break-after works, as well */
        }

        .bg_gray {
            background: #dedede;
        }

        /*align*/
        .table_1 td.tar {
            text-align: right;
        }

        .table_1 td.tal {
            text-align: left;
        }

        .table_1 td.tac {
            text-align: center;
        }

        .table_1 {
            width: 100%;
            border-collapse: collapse;
        }

        /*.table_1 th.b2 {border: 2px solid #166614;}
        .table_1 th.b2lt {border-left: 2px solid #166614;border-top: 2px solid #166614;}
        .table_1 th.b2rt {border-right: 2px solid #166614;border-top: 2px solid #166614;}
        .table_1 th.b2l {border-left: 2px solid #166614;}
        .table_1 th.b2r {border-right: 2px solid #166614;}
        .table_1 th.b2lrt {border-left: 2px solid #166614;border-right: 2px solid #166614;border-top: 2px solid #166614;}
        .table_1 th.b2t {border-top: 2px solid #166614;}*/

        .table_1 td.b2lr {
            border-left: 2px solid #166614;
            border-right: 2px solid #166614;
        }

        .table_1 td.b2lbr {
            border-left: 2px solid #166614;
            border-right: 2px solid #166614;
            border-bottom: 2px solid #166614;
        }

        .table_1 td.b2tr {
            border-top: 2px solid #166614;
            border-right: 2px solid #166614;
        }

        .table_1 td.b2t {
            border-top: 2px solid #166614;
        }

        .table_1 td.b2tb {
            border-top: 2px solid #166614;
            border-bottom: 2px solid #166614;
        }

        .table_1 td.b2lt {
            border-left: 2px solid #166614;
            border-top: 2px solid #166614;
        }

        .table_1 td.b2ltb {
            border-left: 2px solid #166614;
            border-top: 2px solid #166614;
            border-bottom: 2px solid #166614;
        }

        .table_1 td.b2rtb {
            border-right: 2px solid #166614;
            border-top: 2px solid #166614;
            border-bottom: 2px solid #166614;
        }

        .table_1 td.b2l {
            border-left: 2px solid #166614;
        }

        .table_1 td.b2r {
            border-right: 2px solid #166614;
        }

        .table_1 td.b2lb {
            border-bottom: 2px solid #166614;
            border-left: 2px solid #166614;
        }

        .table_1 td.b2b {
            border-bottom: 2px solid #166614;
        }

        .table_1 td.b2rb {
            border-bottom: 2px solid #166614;
            border-right: 2px solid #166614;
        }

        .table_1 th, td {
            border: 1px solid black;
            text-align: center;
            padding-left: 3px;
            padding-right: 3px;
        }

        .table_1 .line {
            border: 1px solid #166614;
            color: #166614;
            font-size: 14px;
        }

        .table_1 .line.clb {
            color: black;
            font-weight: 600;
            font-size: 12px;
            font-family: Ìú¥Î®ºÍ≥†Îîï;
        }

        .table_1 .line.clb.money {
            font-size: 20px;
        }

        .table_1 td > .ts {
            font-size: 10px;
        }

        .table_1 td > .ts2 {
            font-size: 18px;
            position: relative;
            top: 10px;
        }

        .table_1 .title {
            font-size: 24px;
            font-weight: 600;
            padding: 5px;
        }

        .wj-align-left {
            text-align: left !important;
        }

        .wj-colheaders .wj-cell {
            text-align: center !important;
        }
    </style>

</head>

<th:block layout:fragment="content">
    <div class="layout-contents">
        <div class="page-title-wrap">
            <div class="left">
                <h2>ÏûêÏû¨ Ïù¥Îèô</h2>
                <a title="Î∂ÅÎßàÌÅ¨" class="bookmark toggle">
                    ÎÇ¥ Î©îÎâ¥
                </a>
<!--                <button type="button" class="btn-default pull-right mr-1" id="btnHeaderCompress" title="ÌôîÎ©¥ ÌôïÎåÄ/Ï∂ïÏÜå"><i class="fas fa-compress" id="iCompress"></i></button>-->
            </div>

            <ul class="page-navi">
                <li><img src="/images/icon/ico-nav-home.svg" alt="ÌôàÏïÑÏù¥ÏΩò"></li>
                <li>Ïû¨Í≥†Í¥ÄÎ¶¨</li>
                <li>ÏûêÏû¨ Ïù¥Îèô</li>
            </ul>
        </div>
        <section class="section">
            <div class="section-top">
                <form id="searchForm" autocomplete="off" style="width: 100%;">
                    <div class="search-flex-row">
                        <div class="search-wrap">
                            <dl>
                                <dt>
                                    ÏûÖÏ∂úÏùº
                                </dt>
                                <dd>
                                    <ul class="date-box">
                                        <li>
                                            <input type="date" id="srchStartDt" name="srchStartDt">
                                            <label for="srchStartDt" class="hide">ÏãúÏûëÏùº</label>
                                        </li>
                                        <li>
                                            <input type="date" id="srchEndDt" name="srchEndDt">
                                            <label for="srchEndDt" class="hide">Ï¢ÖÎ£åÏùº</label>
                                        </li>
                                    </ul>
                                </dd>
                            </dl>

                            <dl>
                                <dt>
                                    <label for="cboHouse">
                                        Ï∞ΩÍ≥†<span class="eq"></span>
                                    </label>
                                </dt>
                                <dd>
                                    <div class="srch-box">
                                        <select id="cboHouse" name="cboHouse" style="width: 120px;">
                                        </select>
                                    </div>
                                </dd>
                            </dl>

<!--                            <dl>-->
<!--                                <dt>-->
<!--                                    <label for="cboMatType">-->
<!--                                        ÌíàÎ™©Ïú†Ìòï<span class="eq"></span>-->
<!--                                    </label>-->
<!--                                </dt>-->
<!--                                <dd>-->
<!--                                    <div class="srch-box">-->
<!--                                        <select id="cboMatType" name="cboMatType">-->
<!--                                        </select>-->
<!--                                    </div>-->
<!--                                </dd>-->
<!--                            </dl>-->

                            <dl>
                                <dt>
                                    <label for="cboMatGroup">
                                        ÌíàÎ™©Í∑∏Î£π
                                    </label>
                                </dt>
                                <dd>
                                    <div class="srch-box">
                                        <select id="cboMatGroup" name="cboMatGroup" style="width: 120px;">
                                        </select>
                                    </div>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label for="txtMatName">
                                        ÌíàÎ™Ö
                                    </label>
                                </dt>
                                <dd>
                                    <div class="srch-box">
                                        <input id="txtMatName" name="txtMatName" style="width: 160px;"/>
                                    </div>
                                </dd>
                            </dl>

                            <dl>
                                <dt>&nbsp;</dt>
                                <dd>
                                    <li>
                                        <a class="btn btn-delete" title="Í≤ÄÏÉâ" id="btnSearch">
                                            <img src="/images/icon/btn-srch.svg" alt="Í≤ÄÏÉâ ÏïÑÏù¥ÏΩò">
                                            Í≤ÄÏÉâ
                                        </a>
                                    </li>
                                </dd>
                            </dl>
                        </div>
<!--                        <div class="button-wrap" style="white-space: nowrap;">-->
<!--                            <ul>-->
<!--                                <li>-->
<!--                                    <a class="btn" title="ÌíàÎ™© ÏûÖÍ≥†" id="btnInput" style="background-color: #03428E; color: white;">-->
<!--                                        ÏûÖÏ∂úÍ≥† Îì±Î°ù-->
<!--                                    </a>-->
<!--                                </li>-->
<!--                            </ul>-->
<!--                        </div>-->
                    </div>
                </form>
                <div class="button-wrap">
                    <ul>
<!--                        <li>-->
<!--                            <a class="btn" title="Îì±Î°ù" id="btnShowMovePopup">-->
<!--                                Ï∞ΩÍ≥† Ïù¥Îèô-->
<!--                            </a>-->
<!--                        </li>-->
                        <li>
                            <a class="btn" title="ÏûêÏû¨ ÏûÖÍ≥†" id="btnInput">
                                ÏûêÏû¨ ÏûÖÍ≥†
                            </a>
                        </li>
                        <li>
                            <a class="btn" title="ÌíàÎ™© ÏûÖÍ≥†" id="btnBaljuInput">
                                Î∞úÏ£º ÏûÖÍ≥†
                            </a>
                        </li>
                        <li>
                            <a class="btn" title="Î∂àÏ∂ú ÏûÖÍ≥†" id="btnOutput" >
                                Î∂àÏ∂ú Îì±Î°ù
                            </a>
                        </li>
                        <li>
                            <a class="btn" title="ÌíàÎ™© ÏûÖÍ≥†" id="btnDisposal">
                                ÌèêÍ∏∞ Îì±Î°ù
                            </a>
                        </li>
<!--                        <li>-->
<!--                            <a class="btn" title="Îã§Ï§ë ÏûÖÍ≥†" id="btnMultiInput">-->
<!--                                Îã§Ï§ë ÏûÖÍ≥†-->
<!--                            </a>-->
<!--                        </li>-->
<!--                        <li>-->
<!--                            <a class="btn" title="ÏûÖÍ≥†Í≤ÄÏÇ¨" id="btnInputTest">-->
<!--                                ÏûÖÍ≥†Í≤ÄÏÇ¨-->
<!--                            </a>-->
<!--                        </li>-->
                        <li>
                            <a class="btn" title="Î°úÌä∏ ÏûÖÍ≥† Îì±Î°ù" id="btnLotInput">
                                Î°úÌä∏ ÏûÖÍ≥† Îì±Î°ù
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="container-fluid">
                <div id="material-storehouse-grid" style="height: 680px;"></div>
            </div>
        </section>
    </div>

    <script type="text/x-tmpl" id="addDataPopup">
        <div class="content_wrap popup">
            <div class="table-wrap">
                <form id="materialInoutForm">
                    <input type="hidden" id="mio_pk" name="mio_pk">
                    <table class="write-table">
                        <tbody>
                            <tr>
                                <th style="text-align: center">
                                    <label for="inoutDate">ÏûÖÏ∂úÏùº</label>
                                </th>
                                <td>
                                    <input class="form-control2" id="inoutDate" name="inoutDate" type="datetime-local">
                                </td>
                                <th style="text-align: center; display:none;">
                                    <label for="inoutSelect">ÏûÖÏ∂ú Íµ¨Î∂Ñ</label>
                                </th>
                                <td style="display:none;">
                                    <select id="inoutSelect" name="inoutSelect">
                                        <option value="in" >ÌíàÎ™© ÏûÖÍ≥†</option>
                                        <option value="out">ÌíàÎ™© Ï∂úÍ≥†</option>
                                        <option value="return">ÏûÖÍ≥† Î∞òÌíà</option>
                                        <option value="recall">Ï∂úÍ≥† ÌöåÏàò</option>
                                    </select>
                                    <input type="hidden" id="inoutSelect_hidden" name="inoutSelect_hidden">
                                </td>
                                 <th style="text-align: center">
                                    <label for="InoutType">Íµ¨Î∂Ñ</label>
                                </th>
                                <td colspan="3">
                                    <select class="select_input" id="InoutType" name="InoutType" disabled></select>
                                    <input id="InoutType_hidden" name="InoutType_hidden" type="hidden">
                                </td>
                            </tr>
                            <tr id="trCompany">
                                <th style="text-align: center">
                                    <label for="cboCompany">Í±∞ÎûòÏ≤ò</label>
                                </th>
                                <td colspan="3">
                                    <input id="cboCompany" name="cboCompany" type="hidden">
                                    <input  type="text" id="CompanyName" name="CompanyName"
                                     placeholder="Í≤ÄÏÉâÎ≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Í±∞ÎûòÏ≤òÎ•º Í≤ÄÏÉâÌïòÏÑ∏Ïöî" readonly/>
                                    &nbsp;
                                    <a class="btn btn-delete" title="Í≤ÄÏÉâ" id="btnCompanySearch">
                                        <img src="/images/icon/btn-srch.svg" alt="Í≤ÄÏÉâ ÏïÑÏù¥ÏΩò">
                                        Í±∞ÎûòÏ≤ò Í≤ÄÏÉâ
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="cboMaterialType">ÌíàÎ™©Ïú†Ìòï</label>
                                </th>
                                <td>
                                    <input class="form-control2" id="cboMaterialType" name="cboMaterialType" readonly type="hidden"/>
                                    <input class="form-control2" id="cboMaterialTypeName" name="cboMaterialTypeName" readonly />
                                </td>
                                <th style="text-align: center">
                                    <label for="cboMaterialGroup">ÌíàÎ™©Í∑∏Î£π</label>
                                </th>
                                <td>
                                    <input id="cboMaterialGroup" name="cboMaterialGroup" readonly type="hidden"/>
                                    <input id="cboMaterialGroupName" name="cboMaterialGroupName" readonly />
                                </td>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="Material_id">ÌíàÎ™©</label>
                                </th>
                                <td colspan="3">
                                    <input id="Material_id" name="Material_id" readonly type="hidden" />
                                    <input id="Material_name" name="Material_name" readonly placeholder="ÌíàÎ™© Ï°∞Ìöå Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî." />
                                    &nbsp;
                                    <a class="btn" title="ÌíàÎ™© Ï°∞Ìöå" id="btnMaterial">
                                        <img src="/images/icon/btn-srch.svg" alt="Í≤ÄÏÉâ ÏïÑÏù¥ÏΩò">
                                        ÌíàÎ™©Ï°∞Ìöå
                                    </a>

                                </td>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="InoutQty">ÏàòÎüâ</label>
                                </th>
                                <td>
                                    <input id="InoutQty" name="InoutQty" />
                                </td>
                                <th style="text-align: center">
                                    <label for="StoreHouse_id">Ï∞ΩÍ≥†ÏßÄÏ†ï</label>
                                </th>
                                <td>
                                    <select id="StoreHouse_id" name="StoreHouse_id"  />
                                </td>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="Description">ÎπÑÍ≥†</label>
                                </th>
                                <td colspan="3">
                                    <textarea id="Description" name="Description"></textarea>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </form>
            </div>

            <div class="popup-button">
                <button type="button" class="btn-popup" id="btnSave" ><span data-labelCd="Ï†ÄÏû•">Ï†ÄÏû•</span></button>
                <button type="button" class="btn-popup" id="btnDelete" style="display:none;" ><span data-labelCd="ÏÇ≠Ï†ú">ÏÇ≠Ï†ú</span></button>
                <button type="button" class="btn-popup" id="modal-close-button"><span data-labelCd="Îã´Í∏∞">Îã´Í∏∞</span></button>
            </div>
        </div>

    </script>

    <script type="text/x-tmpl" id="addMultiDataPopup">
        <div class="content_wrap popup">
            <div class="table-wrap">
                <form id="mat_multi_input_form">
                    <table class="write-table">
                        <tbody>
                            <tr>
                                <th style="text-align: center">
                                    <label for="InoutType">Íµ¨Î∂Ñ</label>
                                </th>
                                <td>
                                    <select class="form-control2 tal"id="InoutType" name="InoutType"></select>
                                </td>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="Company_id">ÏóÖÏ≤¥</label>
                                </th>
                                <td>
                                    <select class="form-control2" id="Company_id" name="Company_id"  ></select>
                                </td>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="StoreHouse_id">Ï∞ΩÍ≥†ÏßÄÏ†ï</label>
                                </th>
                                <td colspan="3">
                                    <select class="form-control2" id="StoreHouse_id" name="StoreHouse_id" ></select>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </form>
                <section style="margin-top: 10px;">
                    <div class="title-wrap" style="margin-top: 10px;">
                        <ul class="tab-links">
                            <li class="active"><a href="#tab_copy_text">Îã§Ï§ë ÏûÖÎ†• ÌÖçÏä§Ìä∏</a></li>
                            <li><a href="#tab_multi_grid">Í∑∏Î¶¨Îìú</a></li>
                        </ul>
                    </div>
                    <div class="tab-contents">
                        <div class="tab-item" id="tab_copy_text" style="display:block; border-top-left-radius: 0;">
                            <div class="section-top" style="margin-bottom:10px; height:30px;" >
                                <span class="left_align lpt">ÌíàÎ™©ÏΩîÎìú+ÏàòÎüâÏùÑ ÏóëÏÖÄÏóêÏÑú Î∂ôÏó¨ÎÑ£ÏúºÏÑ∏Ïöî.</span>
                                <span class="left_align lpt">Í∑∏Î¶¨Í≥† Í∑∏Î¶¨Îìú ÌÉ≠ÏúºÎ°ú Ïù¥ÎèôÌõÑ Î≥ÄÌôò Î≤ÑÌäºÏùÑ ÎàÑÎ•¥ÏÑ∏Ïöî.</span>
                            </div>
                            <textarea class="form-control2" id="txtCopyText" name="txtCopyText" rows="20" style="height:200px;"></textarea>
                        </div>
                        <div class="tab-item" id="tab_multi_grid">
                            <div class="section-top" style="margin-bottom:10px; height:30px;" >
                                <span class="left_align lpt">Ïó¨Îü¨ ÌíàÎ™©, ÏàòÎüâÏùÑ ÌïúÍ∫ºÎ≤àÏóê Ï†ÄÏû•Ìï©ÎãàÎã§.</span>
                                <div>
                                    <button type="button" class="btn" id="btnTextToGrid">Î≥ÄÌôò</button>
                                    <button type="button" class="btn y_write_auth" id="btnSaveMultiData">Ï†ÄÏû•</button>
                                </div>
                            </div>
                            <div id="multi_input_grid" style="height: 200px;margin-bottom:5px;"></div>
                        </div>
                    </div>
                </section>
            </div>
            <div class="popup-button">
                <button type="button" class="btn-popup" id="modal-close-button">Îã´Í∏∞</button>
            </div>
        </div>
    </script>

    <script type="text/x-tmpl" id="addBaljuInputPopup">
        <div class="content_wrap popup">
            <div class="table-wrap">
                <div class="section-top">
                    <div class="search-wrap" style="justify-content: flex-start;">
                      <dl>
                        <dt style="display:flex;">
                          Ï°∞ÌöåÍ∏∞Í∞Ñ
                        </dt>
                        <dd>
                          <ul class="date-box">
                            <li>
                              <input type="date" id="srchStartDt" name="srchStartDt">
                              <label for="srchStartDt" class="hide">ÏãúÏûëÏùº</label>
                            </li>
                            <li>
                              <input type="date" id="srchEndDt" name="srchEndDt">
                              <label for="srchEndDt" class="hide">Ï¢ÖÎ£åÏùº</label>
                            </li>
                          </ul>
                        </dd>
                      </dl>

                      <dl>
                        <dt>&nbsp;</dt>
                        <dd>
                          <li>
                            <a class="btn btn-delete" title="Í≤ÄÏÉâ" id="btnSearch">
                              <!--                                        class Ïì∞Ïù¥Îäî Í≥≥ Ï∞æÍ≥† ÏóÜÏúºÎ©¥ ÌÅ¥ÎûòÏä§Î™Ö ÏàòÏ†ïÌïòÍ∏∞-->
                              <img src="/images/icon/btn-srch.svg" alt="Í≤ÄÏÉâ ÏïÑÏù¥ÏΩò">
                              Í≤ÄÏÉâ
                            </a>
                          </li>
                        </dd>
                      </dl>
                    </div>
                </div>
                <div class="container-fluid">
                    <div id="balju-input-grid" style="max-height: 400px;min-height: 200px;"></div>
                </div>
                <div class="popup-button">
                    <button type="button" class="btn-popup y_write_auth" id="btnBaljuAction"><span data-labelCd="ÏûÖÍ≥†Ï≤òÎ¶¨">ÏûÖÍ≥†Ï≤òÎ¶¨</span></button>
                    <button type="button" class="btn-popup" id="modal-close-button">Îã´Í∏∞</button>
                </div>
            </div>
        </div>

    </script>

    <script type="text/x-tmpl" id="matMovePopup">
        <div class="content_wrap popup">
            <div class="table-wrap">
                <form id="materialMoveForm">
                    <table class="write-table" style="border-top: 1px solid #D4D5D7">
                        <tbody>
                            <tr>
                                <th colspan="4" style="text-align: center">
                                    Ï∞ΩÍ≥†ÏÑ†ÌÉù
                                </th>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="cboFrom">From Ï∞ΩÍ≥†</label>
                                </th>
                                <td>
                                    <select class="form-control2 tac" id="cboFrom" name="from" ></select>
                                </td>
                                <th style="text-align: center">
                                    <label for="cboTo">To Ï∞ΩÍ≥†</label>
                                </th>
                                <td>
                                    <select class="form-control2 tac" id="cboTo" name="to" ></select>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="write-table" style="border-top: 1px solid #D4D5D7">
                        <tbody>
                            <tr>
                                <th colspan="4" style="text-align: center">
                                    Ï†úÌíà ÏÉùÏÇ∞ ÏàòÎüâ Í∏∞Ï§Ä
                                </th>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="cboMaterialType">Ï†úÌíà/Î∞òÏ†úÌíà</label>
                                </th>
                                <td>
                                    <select id="cboMaterialType" name="MaterialType">
                                        <option value='product' data-labelCd="Ï†úÌíà">Ï†úÌíà</option>
                                        <option value='semi' data-labelCd="Î∞òÏ†úÌíà">Î∞òÏ†úÌíà</option>
                                    </select>
                                </td>
                                <th style="text-align: center">
                                    <label for="cboMaterial">Ï†úÌíà</label>
                                </th>
                                <td>
                                    <select id="cboMaterial" name="cboMaterial" ></select>
                                </td>
                            </tr>

                        </tbody>
                    </table>
                </form>
            </div>
            <div class="grid_box">
                <div style="margin:15px 0;">
                    <button type="button" class="btn" id="btnMatSearch"><span data-labelCd="Ï°∞Ìöå">Ï°∞Ìöå</span></button>
                    <button type="button" class="btn y_write_auth" id="btnMoveAction"><span data-labelCd="Ïù¥ÎèôÏ≤òÎ¶¨">Ïù¥ÎèôÏ≤òÎ¶¨</span></button>
                </div>
                <div id="material-grid" style="height: 200px;"></div>
            </div>

            <div class="popup-button">
                <button type="button" class="btn-popup" id="modal-close-button"><span data-labelCd="Îã´Í∏∞">Îã´Í∏∞</span></button>
            </div>
        </div>
    </script>

    <script type="text/x-tmpl" id="lotInputPopup">
        <div class="content_wrap popup">
            <div class="table-wrap">
                <form id="lotInputForm">
                    <table class="write-table">
                        <tbody>
                            <tr>
                                <th style="text-align: center">
                                    <label for="MaterialTypeName">ÌíàÎ™©Ïú†Ìòï</label>
                                </th>
                                <td>
                                    <input type="text" class="form-control2" id="MaterialTypeName" name="MaterialTypeName" readonly />
                                </td>
                                <th style="text-align: center">
                                    <label for="MaterialName">ÌíàÎ™©</label>
                                </th>
                                <td>
                                    <input type="text" class="form-control2" id="MaterialName" name="MaterialName" readonly />
                                </td>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="ValidDays">Í∏∞Î≥∏Ïú†Ìö®Ïùº</label>
                                </th>
                                <td>
                                    <input class="form-control2 tac" type="text" id="ValidDays" name="ValidDays" readonly />
                                </td>
                                <th style="text-align: center">
                                    <label for="StoreHouseName">ÏûÖÍ≥†Ï∞ΩÍ≥†</label>
                                </th>
                                <td>
                                    <input class="form-control2" id="StoreHouseName" name="StoreHouseName" readonly />
                                </td>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="UnitName">Îã®ÏúÑ</label>
                                </th>
                                <td>
                                    <input class="form-control2 tac" type="text" id='UnitName' name="UnitName" readonly />
                                </td>
                                <th style="text-align: center">
                                    <label for="InputQty">ÏûÖÍ≥†ÏàòÎüâ</label>
                                </th>
                                <td>
                                    <input class="form-control2 tar" type="number" id='InputQty' name="InputQty" />
                                </td>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="EffectiveDate">Ïú†Ìö®ÏùºÏãú</label>
                                </th>
                                <td>
                                    <input type="date" id="EffectiveDate" name="EffectiveDate">
                                </td>
                                <th style="text-align: center">
                                    <label for="LotSize">Î°úÌä∏ÎãπÏàòÎüâ</label>
                                </th>
                                <td>
                                    <input class="form-control2 tar" type="number" id='LotSize' name="LotSize" />
                                </td>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="mio_pk">ÏûÖÍ≥†Î≤àÌò∏</label>
                                </th>
                                <td colspan="3">
                                    <input class="form-control2 tar" type="number" id='mio_pk' name="mio_pk" readonly />
                                    <a class="btn" id="btnLotCalc">
                                        Î°úÌä∏Í≥ÑÏÇ∞
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </form>
            </div>
            <div class="grid_box" style="margin-top: 5px;">
                <div id="mat-lot-grid" style="height: 200px;"></div>
            </div>

            <div class="popup-button">
                <button type="button" class="btn-popup" id="modal-close-button"><span data-labelCd="Îã´Í∏∞">Îã´Í∏∞</span></button>
                <button type="button" class="btn-popup" id="btnLotRefresh"><span data-labelCd="ÏÉàÎ°úÍ≥†Ïπ®">ÏÉàÎ°úÍ≥†Ïπ®</span></button>
                <button type="button" class="btn-popup y_write_auth" id="btnLotSave"><span data-labelCd="Î°úÌä∏Ï†ÄÏû•">Î°úÌä∏Ï†ÄÏû•</span></button>
                <button type="button" class="btn-popup" id="btnBarcordPrint"><span data-labelCd="Î∞îÏΩîÎìúÏ∂úÎ†•">Î∞îÏΩîÎìúÏ∂úÎ†•</span></button>
            </div>
        </div>

    </script>

    <script type="text/x-tmpl" id="inputTestPopup">
        <div class="content_wrap popup">
            <div class="table-wrap">
                <form id="lotInputForm">
                    <table class="write-table">
                        <tbody>
                        <input type="hidden" id="testResultId" name="testResultId">
                            <tr>
                                <th style="text-align: center">
                                    <label for="cboTestMaster">Í≤ÄÏÇ¨Ïú†Ìòï</label>
                                </th>
                                <td colspan="3">
                                    <select class="form-control2 tac" id="cboTestMaster" name="cboTestMaster" ></select>
                                </td>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="MaterialTypeName">ÌíàÎ™©Ïú†Ìòï</label>
                                </th>
                                <td>
                                    <input type="text" class="form-control2" id="MaterialTypeName" name="MaterialTypeName" readonly />
                                </td>
                                <th style="text-align: center">
                                    <label for="MaterialCode">ÌíàÎ™©ÏΩîÎìú</label>
                                </th>
                                <td>
                                    <input type="text" class="form-control2" id="MaterialCode" name="MaterialCode" readonly />
                                </td>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="MaterialName">ÌíàÎ™©Î™Ö</label>
                                </th>
                                <td>
                                    <input type="text" class="form-control2" id="MaterialName" name="MaterialName" readonly />
                                </td>
                                <th style="text-align: center">
                                    <label for="InoutDate">ÏûÖÍ≥†ÏùºÏãú</label>
                                </th>
                                <td>
                                    <input style="width:190px" id="InoutDate" name="InoutDate" readonly />
                            	    <input style="width:160px" id="InoutTime" name="InoutTime" readonly />
                                </td>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="EffectiveDate">Ïú†Ìö®Í∏∞Í∞Ñ</label>
                                </th>
                                <td>
                                    <input type="date" id="EffectiveDate" name="EffectiveDate" readonly />
                                </td>
                                <th style="text-align: center">
                                    <label for="inputQty">Í∞ÄÏûÖÍ≥†Îüâ</label>
                                </th>
                                <td>
                                    <input type="text" class="form-control2 text-center" id="inputQty" name="inputQty" readonly />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </form>
            </div>
            <div class="table-wrap" style="margin-top:5px;">
                <table class="write-table">
                    <colgroup>
                        <col class="wp18">
                        <col class="wp32">
                        <col class="wp18">
                        <col class="wp32">
                    </colgroup>
                    <tbody>
                        <tr>
                            <th style="text-align: center">
                                <label for="TestDate">Í≤ÄÏÇ¨Ïùº</label>
                            </th>
                            <td>
                                <input style="width:200px" type="date" id="TestDate" name="testDate" readonly />
                            </td>
                            <th style="text-align: center">
                                <label for="TestName">Í≤ÄÏÇ¨Ïûê</label>
                            </th>
                            <td>
                                <input style="width:160px" id="TestName" name="testName" readonly />
                                <a class="btn" title="Ï†ÑÏ≤¥Ï†ÅÌï©" id="btnAllItem">
                                    Ï†ÑÏ≤¥Ï†ÅÌï©
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="container-fluid" style="margin-top:5px;">
                <div id="mat-input-test-grid" style="height: 200px;"></div>
            </div>

            <div class="table-wrap" style="margin-top:5px;">
                <table class="write-table">
                    <tbody>
                        <tr>
                            <th style="text-align: center">
                                <label for="judgGroup">Ï¢ÖÌï© ÌåêÏ†ï*</label>
                            </th>
                            <td colspan="3">
                                <select class="form-control2" id="judgGroup" name="judgGroup"  ></select>
                            </td>
                        </tr>
                        <tr>
                            <th style="text-align: center">
                                <label for="testRemark">Î∂ÄÏ†ÅÌï© Ïãú Ï°∞ÏπòÎÇ¥Ïö©</label>
                            </th>
                            <td colspan="3">
                                <textarea style="height:36px" id="testRemark" name="testRemark"></textarea>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="popup-button">
                <button type="button" class="btn-popup" id="btnTestSave" ><span data-labelCd="Ï†ÄÏû•">Ï†ÄÏû•</span></button>
                <button type="button" class="btn-popup" id="modal-close-button"><span data-labelCd="Îã´Í∏∞">Îã´Í∏∞</span></button>
            </div>
        </div>

    </script>

    <script type="text/x-tmpl" id="barcode_tmpl">
        <div class="content_wrap popup">
            <section class="pt-2" style="overflow:auto; height:600px;">
                <div class="row" id="barcodeDiv"></div>
            </section>
            <div class="popup-button">
                <button type="button" class="btn-popup" id="btnPopPrintBarcode" ><span data-labelCd="Î∞îÏΩîÎìúÏù∏ÏáÑ">Î∞îÏΩîÎìúÏù∏ÏáÑ</span></button>
                <button type="button" class="btn-popup" id="modal-close-button"><span data-labelCd="Îã´Í∏∞">Îã´Í∏∞</span></button>
            </div>

        </div>
    </script>

    <script type="text/x-tmpl" id="barcode_table_tmpl">
        <table class="table_1" style="width: 400px;border-collapse: collapse;">
            <tr>
                <td class="tac">ÌíàÎ™©ÏΩîÎìú</td>
                <td>{%=o.MaterialCode%}</td>
                <td class="tac">Î≥¥Í¥ÄÎ∞©Î≤ï</td>
                <td></td>
            </tr>
            <tr>
                <td class="tac">ÌíàÎ™Ö</td>
                <td colspan="3">{%=o.MaterialName%}</td>
            </tr>
            <tr>
                <td class="tac">LOTÏàòÎüâ</td>
                <td>{%=o.InputQty%}</td>
                <td class="tac">Ìè¨Ïû•Îã®ÏúÑ</td>
                <td>{%=o.UnitName%}</td>
            </tr>

            <tr>
                <td class="tac">ÏûÖÍ≥†ÏùºÏûê</td>
                <td colspan="3">{%=o.InputDateTime%}</td>
            </tr>
            <tr>
                <td class="tac">Ïú†Ìö®Í∏∞Ìïú</td>
                <td colspan="3">{%=o.EffectiveDate%}</td>
            </tr>
            <tr>
                <td colspan="4" class="barcode_td">
                </td>
            </tr>
        </table>
        <div style="width:auto;height;0px;page-break-before:always;line-height:5px;">&nbsp;</div>

    </script>
</th:block>


<th:block layout:fragment="scripts">
    <script type="text/javascript" src="/resource/jsBarcode/JsBarcode.all.min.js"></script>
    <th:block th:replace="/common/popup_material :: popup_material"></th:block>
    <th:block th:replace="/common/popup_company :: popup_company"></th:block>

    <script type="text/javascript">
        class materialStorehouse {
            constructor() {
                this.url = '/api/inventory/material_inout';
                this.grid = null;
                this.init();
            }

            init() {
                const _this = this;

                this.grid = new wijmo.grid.FlexGrid('#material-storehouse-grid', {
                    autoGenerateColumns: false,
                    selectionMode: wijmo.grid.SelectionMode.Row,
                    headersVisibility: wijmo.grid.HeadersVisibility.All,
                    isReadOnly: true,
                    showMarquee: true,
                    formatItem: (sender, e) => {
                        if (e.panel.cellType === wijmo.grid.CellType.RowHeader) {
                            // Ìó§ÎçîÏóê ÏàúÎ≤à
                            e.cell.textContent = (e.row + 1).toString();
                        }
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            e.cell.style.textAlign = 'center'; // Ìó§Îçî Í∞ÄÏö¥Îç∞ Ï†ïÎ†¨
                        }
                    },
                    columns: [
                        // {binding: 'mio_pk', header: 'ÏûÖÍ≥†Î≤àÌò∏', width: 80, align: 'center'},
                        {binding: 'store_house_name', header: 'Ï∞ΩÍ≥†', width: 80, align: 'center'},
                        {binding: 'inout', header: 'ÏûÖÏ∂ú', width: 60, align: 'center'},
                        {binding: 'inout_type', header: 'Íµ¨Î∂Ñ', width: 100, align: 'center'},
                        {binding: 'material_type', header: 'ÌíàÎ™©Ïú†Ìòï', width: 80, align: 'center'},
                        {binding: 'material_code', header: 'ÌíàÎ™©ÏΩîÎìú', width: 100, align: 'center'},
                        {binding: 'material_name', header: 'ÌíàÎ™©Î™Ö', width: 170, align: 'left'},
                        {binding: 'unit_name', header: 'Îã®ÏúÑ', width: 50, align: 'center'},
                        {binding: 'InoutDate', header: 'ÏûÖÏ∂úÏùº', width: 100, align: 'center'},
                        {binding: 'InoutTime', header: 'ÏãúÍ∞Ñ', width: 60, align: 'center'},
                        {binding: 'potentialInputQty', header: 'Í∞ÄÏûÖÍ≥†Îüâ', width: 80, align: 'right', format: 'n0'},
                        {binding: 'InputQty', header: 'ÏûÖÍ≥†Îüâ', width: 80, align: 'right', format: 'n0'},
                        {binding: 'OutputQty', header: 'Ï∂úÍ≥†Îüâ', width: 80, align: 'right', format: 'n0'},
                        {binding: 'HouseStock', header: 'Ï∞ΩÍ≥†Ïû¨Í≥†', width: 80, align: 'right', format: 'n0'},
                        {binding: 'lot_count', header: 'Î°úÌä∏Í∞úÏàò', width: 80, align: 'center'},
                        {binding: 'CurrentStock', header: 'Ï†ÑÏ≤¥Ïû¨Í≥†', width: 80, align: 'right', format: 'n0'},
                        {binding: 'Description', header: 'ÎπÑÍ≥†', width: 150, align: 'left'},
                        {binding: 'inout_state', header: 'ÏûÖÍ≥† ÏÉÅÌÉú', width: 100, align: 'center'},
                        // {binding: 'state_name', header: 'ÏûÖÍ≥†Í≤ÄÏÇ¨ Í≤∞Ïû¨', width: 100, align: 'center'},
                        {binding: 'judge_code', header: 'ÏûÖÍ≥†Í≤ÄÏÇ¨ ÌåêÏ†ï', width: 100, align: 'center'},
                        {binding: 'lot_use', header: 'Î°úÌä∏Í¥ÄÎ¶¨Ïú†Î¨¥', width: 100, align: 'center'},

                        // {binding: 'SafetyStock', header: 'ÏïàÏ†ÑÏû¨Í≥†', width: 100, align: 'right', format: 'n0'}
                    ],
                    itemsSource: new wijmo.collections.CollectionView([]),
                    itemFormatter: (panel, row, col, cell) => {
                        if (panel.cellType === wijmo.grid.CellType.Cell) {
                            const item = panel.rows[row].dataItem;
                            const column = panel.columns[col];

                            // Ï∞ΩÍ≥†Ïû¨Í≥† Ï°∞Í±¥Î∂Ä Ïä§ÌÉÄÏùºÎßÅ
                            if (column.binding === 'HouseStock' && item.HouseStock < 0) {
                                cell.classList.add('redText');
                            }

                            // Ï†ÑÏ≤¥Ïû¨Í≥† Ï°∞Í±¥Î∂Ä Ïä§ÌÉÄÏùºÎßÅ
                            if (column.binding === 'CurrentStock' && item.CurrentStock < item.SafetyStock) {
                                cell.classList.add('redText');
                            }

                            if (column.binding === 'mio_pk') {
                                cell.textContent = item.mio_pk?.toString(); // ÏΩ§Îßà Ï†úÍ±∞Ìï¥ÏÑú Í∑∏ÎåÄÎ°ú Ï∂úÎ†•
                            }
                        }
                    }
                });
                new FlexGridContextMenu(this.grid);
                this.grid.downloadFileName = 'ÏûêÏû¨ ÏûÖÏ∂úÍ≥† ÎÇ¥Ïó≠';

                let isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

                if (isTouchDevice) {
                    // üì± ÌÉúÎ∏îÎ¶ø/Î™®Î∞îÏùº: Îã®Ïùº ÌÅ¥Î¶≠
                    this.grid.hostElement.addEventListener('click', function (e) {
                        let ht = _this.grid.hitTest(e);
                        if (ht.cellType === wijmo.grid.CellType.Cell) {
                            let item = _this.grid.rows[ht.row].dataItem;
                            _this.modify([item]);
                        }
                    });
                } else {
                    // üíª PC: ÎçîÎ∏îÌÅ¥Î¶≠
                    this.grid.hostElement.addEventListener('dblclick', function (e) {
                        let ht = _this.grid.hitTest(e);
                        if (ht.cellType === wijmo.grid.CellType.Cell) {
                            let item = _this.grid.rows[ht.row].dataItem;
                            _this.modify([item]);
                        }
                    });
                }



                // Î°úÌä∏ÏûÖÍ≥† Î≤ÑÌäº ÌÅ¥Î¶≠
                document.getElementById('btnLotInput').addEventListener('click', () => {
                    this.showLotInputPopup();
                });

                // ÏûÖÍ≥†Í≤ÄÏÇ¨ Î≤ÑÌäº ÌÅ¥Î¶≠
                // document.getElementById('btnInputTest').addEventListener('click', () => {
                //     this.showInputTestPopup();
                // });
            }

            modify(selectedItem) {
                let _this = this;

                let selectedItems = selectedItem;

                if (selectedItems.length === 1) {

                    let data = {
                        mio_pk: selectedItems[0].mio_pk,
                        action: 'detail'
                    };
                    let fnsuccess = function (result) {
                        result.data['mode'] = 'edit';
                        _this.addDataPopup(result.data);
                    };
                    AjaxUtil.getAsyncData(_this.url + '/matinout_detail', data, fnsuccess);
                } else if (selectedItems.length > 1) {
                    Alert.alert('', 'Îç∞Ïù¥ÌÑ∞Î•º ÌïòÎÇòÎßå ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.');
                } else {
                    Alert.alert('', 'ÏÑ†ÌÉùÎêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                }

            }

            searchDataBind() {
                let _this = this;
                let srchStartDt = $('#searchForm').find("#srchStartDt").val();
                let srchEndDt = $('#searchForm').find("#srchEndDt").val();
                let house_pk = $('#searchForm').find('#cboHouse').val();
                let mat_type = $('#searchForm').find('#cboMatType').val();
                let mat_grp_pk = $('#searchForm').find('#cboMatGroup').val();
                let txtMatName = $('#searchForm').find('#txtMatName').val();
                let data = {
                    'action': 'read',
                    'srchStartDt': srchStartDt,
                    'srchEndDt': srchEndDt,
                    'house_pk': house_pk,
                    'mat_type': mat_type,
                    'mat_grp_pk': mat_grp_pk,
                    'keyword': txtMatName
                };

                let result = AjaxUtil.getSyncData(this.url + "/read", data);
                if (result.data != null) {
                    _this.grid.itemsSource = new wijmo.collections.CollectionView(result.data);
                }
            }

            addDataPopup(data) {
                let _this = this;
                let content = tmpl('addDataPopup', {});
                let $content = $(content);
                let form = $content.find('#materialInoutForm');

                let modalContainer = null;
                modalContainer = new PopupDraggable('ÌíàÎ™© ÏûÖÏ∂úÍ≥†');

                function getModalSize() {
                    let winW = window.innerWidth;
                    if (winW <= 1366) {
                        return { width: 810, height: 400 };
                    } else {
                        return { width: 1000, height: 520 };
                    }
                }

                // Ï¥àÍ∏∞ Ïò§Ìîà
                let size = getModalSize();
                modalContainer.open({
                    width: size.width,
                    height: size.height,
                    $content
                });

                // Î¶¨ÏÇ¨Ïù¥Ï¶à Ïãú Îã§Ïãú Ï°∞Ï†ï
                $(window).on('resize.modalResize', function () {
                    let size = getModalSize();
                    let $root = modalContainer.modal.$["root"];
                    $root.css({
                        width: size.width + "px",
                        height: size.height + "px"
                    });
                });

                popup = new materialInoutPopup();
                //AjaxUtil.fillSelectOptions($content.find('#StoreHouse_id'), 'store_house', 'choose', 3);    // 3:ÏûêÏû¨Ï∞ΩÍ≥†
                AjaxUtil.fillSelectOptions($content.find('#StoreHouse_id'), 'store_house', 'choose', '');    // 3:ÏûêÏû¨Ï∞ΩÍ≥†

                AjaxUtil.fillSelectOptions($content.find('#cboMaterialType'), 'system_code', 'choose', '', 'mat_type');
                AjaxUtil.fillSelectOptions($content.find('#cboMaterialGroup'), 'material_group', 'choose', '', '');
                //AjaxUtil.fillSelectOptions($content.find('#cboMaterialGroup'), 'material_group', 'choose', '', 'raw_mat');
                AjaxUtil.fillSelectOptions($content.find('#Material_id'), 'material', 'choose', '');
                //$content.find('select').select2();

                let $inoutDate = $content.find('#inoutDate');
                let now = new Date();

                // ÌïúÍµ≠ ÏãúÍ∞ÑÏúºÎ°ú Î≥¥Ï†ï
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset()); // Î°úÏª¨ ‚Üí ISO Í∏∞Ï§Ä Î≥¥Ï†ï

                let localISOString = now.toISOString().slice(0, 16); // yyyy-MM-ddTHH:mm
                $inoutDate.val(localISOString);

                let type = null;
                $content.find('#inoutSelect').on('change', function () {
                    type = $(this).val(); // ÎòêÎäî $content.find('#inoutSelect').val();

                    if (type === 'in') {
                        AjaxUtil.fillSelectOptions(
                            $content.find('#InoutType'), 'system_code', '', 'etc_in', 'input_type'
                        );
                    } else if (type === 'out') {
                        AjaxUtil.fillSelectOptions(
                            $content.find('#InoutType'), 'system_code', '', 'etc_out', 'output_type'
                        );
                    } else if (type === 'return') {
                        AjaxUtil.fillSelectOptions(
                            $content.find('#InoutType'), 'system_code', '', 'etc_return', 'return_type'
                        );
                    } else if (type === 'recall') {
                        AjaxUtil.fillSelectOptions(
                            $content.find('#InoutType'), 'system_code', '', 'etc_recall', 'recall_type'
                        );
                    } else {
                        $content.find('#InoutType').empty().append('<option value="">ÏÑ†ÌÉù</option>');
                    }

                    formatInoutQty();
                });

                $content.find('#InoutQty').on('input', function () {
                    formatInoutQty();
                });

                function formatInoutQty() {
                    let $qty = $content.find('#InoutQty');
                    let raw = $qty.val().replace(/,/g, '').replace(/[^0-9-]/g, ''); // Ïà´ÏûêÎßå ÎÇ®Í∏∞Í∏∞

                    if (!raw) {
                        $qty.val('');
                        return;
                    }

                    // - Î∂ÄÌò∏ Ï≤òÎ¶¨
                    let isNegative = (type === 'recall' || type === 'return');
                    raw = raw.replace(/^-/, ''); // ÏùåÏàò Í∏∞Ìò∏ Ï†úÍ±∞

                    let num = parseInt(raw, 10);
                    if (isNaN(num)) {
                        $qty.val('');
                        return;
                    }

                    let formatted = num.toLocaleString(); // Ï≤ú Îã®ÏúÑ ÏΩ§Îßà
                    if (isNegative) {
                        formatted = '-' + formatted;
                    }

                    $qty.val(formatted);
                }

                $content.find('#inoutSelect').trigger('change');

                $content.find('#cboMaterialType').on('change', function (e) {
                    let mat_type = $content.find('#cboMaterialType').val();
                    AjaxUtil.fillSelectOptions($content.find('#cboMaterialGroup'), 'material_group', 'choose', '', mat_type);
                });

                $content.find('#cboMaterialGroup').on('change', function (e) {
                    let mat_group = $content.find('#cboMaterialGroup').val();
                    AjaxUtil.fillSelectOptions($content.find('#Material_id'), 'material', 'choose', '', mat_group);
                });

                $content.find('#btnMaterial').click(function () {
                    let searchcallback = function (items) {
                        $content.find('#cboMaterialType').val(items.MaterialTypeCode)
                        $content.find('#cboMaterialTypeName').val(items.MaterialTypeName)
                        $content.find('#cboMaterialGroup').val(items.MaterialGroup_id)
                        $content.find('#cboMaterialGroupName').val(items.group_name)
                        $content.find('#Material_id').val(items.id)
                        $content.find('#Material_name').val(items.Name)
                    };

                    let poppage = new PopupMaterialPage('single');
                    let $poppage = $(poppage);
                    poppage.show(searchcallback);
                });

                $content.find('#btnCompanySearch').click(function () {
                    let poppage = new PopCompComponent();
                    let $poppage = $(poppage);
                    let searchcallback = function (items) {
                        $content.find('#cboCompany').val(items.id);
                        $content.find('#CompanyName').val(items.compname);
                    };

                    poppage.show(searchcallback);
                });

                if (data && data.mode === 'edit') {
                    $content.find('#inoutSelect').val(data[0].inoutSelect);

                        // 1-2. ÏòµÏÖò Î°úÎî© Ìä∏Î¶¨Í±∞
                    $content.find('#inoutSelect').trigger('change');
                    setTimeout(function () {
                        $content.find('#InoutType').prop('disabled', true);
                    }, 50);
                    let outPutType = data[0].OutputType;
                    if (outPutType === 'disposal_out') {
                        $content.find('#trCompany').hide();
                    }


                    setTimeout(function () {
                        FormUtil.BindDataForm(data[0], form);
                        console.log('edit BindDataForm data', data);
                        $content.find('#btnDelete').show();
                        $content.find('#btnSave span').text('ÏàòÏ†ï');
                    }, 10);

                }

                $content.find('#btnSave').on('click', function () {
                    if (!$('#cboMaterialGroup').val()) {
                        Alert.alert('', 'ÌíàÎ™©Í∑∏Î£πÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.');
                        return false;
                    }
                    if (!$('#Material_id').val()) {
                        Alert.alert('', 'ÌíàÎ™©ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.');
                        return false;
                    }
                    if (!$('#StoreHouse_id').val()) {
                        Alert.alert('', 'Ï∞ΩÍ≥†Î•º ÏßÄÏ†ïÌïòÏÑ∏Ïöî.');
                        return false;
                    }

                    if ($('#InoutQty').val() === "") {
                        Alert.alert('', 'ÏàòÎüâÏùÑ ÌôïÏù∏Ìï¥ Ï£ºÏÑ∏Ïöî.');
                        return false;
                    }

                    popup.saveData(type, form);

                    modalContainer.modal.close();
                });
                $content.find('#btnDelete').on('click', function () {

                    let data = {
                        mio_pk: $content.find('#mio_pk').val(),
                        action: 'delete'
                    };
                    console.log('data', data);
                    let url = '/api/inventory/material_inout/delete';
                    AjaxUtil.postJsonData(url, data, function (res) {
                        if (res.success) {
                            Alert.alert('', 'ÏÇ≠Ï†úÍ∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.', function () {
                                _this.searchDataBind();

                            });
                        } else {
                            Alert.alert('', res.message || 'ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                        }
                    });

                    modalContainer.modal.close();
                });


            }

            // Î∞úÏ£º ÏûÖÍ≥†
            showBaljuInputPopup() {
                let _this = this;

                let content = tmpl('addBaljuInputPopup', {});
                let $content = $(content);
                let modalContainer = new PopupDraggable('Î∞úÏ£º ÏûÖÍ≥†');
                modalContainer.open({width: 1300, height: 580, $content});

                this.storeHouseOptions = AjaxUtil.getSelectDataWithNull('store_house', 'choose');

                let dicStoreHouse = {};
                $.each(this.storeHouseOptions, function (idx, item) {
                    dicStoreHouse[item.value] = item.text;
                });

                let storeHouseMap = new wijmo.grid.DataMap(this.storeHouseOptions, 'value', 'text');

                this.baljuInputGrid = new wijmo.grid.FlexGrid('#balju-input-grid', {
                    autoGenerateColumns: false,
                    selectionMode: wijmo.grid.SelectionMode.Row,
                    headersVisibility: wijmo.grid.HeadersVisibility.All,
                    formatItem: (s, e) => {
                        if (e.panel.cellType === wijmo.grid.CellType.Cell) {
                            e.cell.style.color = '';
                            e.cell.style.textAlign = '';
                        }
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            e.cell.style.textAlign = 'center';

                            const binding = s.columns[e.col].binding;

                            if (binding === 'StoreHouse_id' || binding === 'inputQty' || binding === 'Description2') {
                                e.cell.style.color = '#5567ff'; // Í∏ÄÏûê ÏÉâ Ï†ÅÏö©
                            } else {
                                // Ï¥àÍ∏∞Ìôî Ïïà ÌïòÎ©¥ Îã§Î•∏ Ïª¨ÎüºÏóêÎèÑ ÏÉâÏù¥ Îî∞ÎùºÏò¥
                                e.cell.style.color = '';
                            }
                        }
                    },
                    columns: [
                        {binding: 'CompanyName', header: 'Íµ¨Îß§Ï≤ò', width: 100, align: 'left', isReadOnly: true},
                        {binding: 'JumunDate', header: 'Î∞úÏ£ºÏùº', width: 120, align: 'center', isReadOnly: true},
                        {binding: 'JumunNumber', header: 'Î∞úÏ£ºÎ≤àÌò∏', width: 140, align: 'center', isReadOnly: true},
                        {binding: 'product_code', header: 'Ï†úÌíàÏΩîÎìú', width: 100, align: 'left', isReadOnly: true},
                        {binding: 'product_name', header: 'Ï†úÌíàÎ™Ö', width: 150, align: 'left', isReadOnly: true},
                        {binding: 'unit', header: 'Îã®ÏúÑ', width: 60, align: 'center', isReadOnly: true},
                        {binding: 'SujuQty', header: 'Î∞úÏ£º ÏàòÎüâ', width: 80, align: 'right', format: 'n0', isReadOnly: true},
                        {binding: 'SujuQty2', header: 'Í∏∞ÏûÖÍ≥† ÏàòÎüâ', width: 90, align: 'right', isReadOnly: true},
                        {binding: 'DueDate', header: 'ÎÇ©Í∏∞ÏòàÏ†ïÏùº', width: 100, align: 'center', isReadOnly: true},
                        {binding: 'StoreHouse_id', header: 'ÎÇ©Ìíà Ï∞ΩÍ≥†', width: 90, align: 'center',dataMap: storeHouseMap, isReadOnly: false},
                        {binding: 'inputQty', header: 'ÏûÖÍ≥† ÏàòÎüâ', width: 100, align: 'right', isReadOnly: false,
                            editor: new wijmo.input.InputNumber(document.createElement('div'), {
                                format: 'n0', // Ï†ïÏàò ÌòïÏãù
                                min: 0,       // ÏµúÏÜåÍ∞í ÏÑ§Ï†ï
                                max: 99999,   // ÏµúÎåÄÍ∞í ÏÑ§Ï†ï
                                step: 1       // Ï¶ùÍ∞Ä/Í∞êÏÜå Îã®ÏúÑ
                            })
                        },
                        {binding: 'Description2', header: 'ÏÇ¨Ïú†', align: 'left', width: 120, isReadOnly: false},
                        {binding: 'Description', header: 'Î∞úÏ£º Î©îÎ™®', align: 'left', width: 120, isReadOnly: true}
                    ],
                    itemsSource: new wijmo.collections.CollectionView([]),
                });
                let selector = null;
                this.baljuInputGrid.beginningEdit.addHandler((s, e) => {
                    let col = s.columns[e.col];
                    let row = e.row;

                    if (col.binding === 'inputQty') {
                        let currentValue = s.getCellData(row, col.index, false);

                        // ÌòÑÏû¨ Í∞íÏù¥ null, undefined, Îπà Î¨∏ÏûêÏó¥Ïùº ÎïåÎßå ÏàòÌñâ
                        if (currentValue === null || currentValue === undefined || currentValue === '') {
                            let sujuQty = s.getCellData(row, s.columns.getColumn('SujuQty').index, false);
                            let sujuQty2 = s.getCellData(row, s.columns.getColumn('SujuQty2').index, false);

                            sujuQty = parseFloat(sujuQty) || 0;
                            sujuQty2 = parseFloat(sujuQty2) || 0;

                            s.setCellData(row, col.index, sujuQty - sujuQty2);
                        }
                    }
                });

                _this.baljuInputGrid.hostElement.addEventListener('click', function (e) {
                    if (e.target?.type === 'checkbox') {
                        setTimeout(() => {
                            let items = _this.baljuInputGrid.rows
                                .filter(row => row.isSelected)
                                .map(row => row.dataItem);

                            items.forEach(item => {
                                if ((!item.inputQty || item.inputQty === '') && item.SujuQty) {
                                    let sujuQty = parseFloat(item.SujuQty) || 0;
                                    let sujuQty2 = parseFloat(item.SujuQty2) || 0;
                                    item.inputQty = sujuQty - sujuQty2;
                                }
                            });

                            _this.baljuInputGrid.refresh();
                        }, 0);
                    }
                });


                new FlexGridContextMenu(this.baljuInputGrid);
                this.baljuInputGrid.downloadFileName = 'Î∞úÏ£º ÏûÖÍ≥†';

                $content.find('#btnSearch').on('click', function () {
                    fnLoadBaljuList();
                });

                let start = $content.find('#srchStartDt');
                let end = $content.find('#srchEndDt');

                start.val(CommonUtil.getYYYYMMDD(-7));
                end.val(CommonUtil.getYYYYMMDD());

                let fnLoadBaljuList = function () {
                    let fnsuccess = function (result) {
                        if (result.data !== null) {
                            result.data.forEach(item => {
                                if (!item.StoreHouse_id) {
                                    item.StoreHouse_id = _this.storeHouseOptions[0].value; // Ï≤´ Î≤àÏß∏ ÏòµÏÖòÏùò value
                                }
                            });
                            _this.baljuInputGrid.itemsSource = new wijmo.collections.CollectionView(result.data);
                            selector = new wijmo.grid.selector.Selector(_this.baljuInputGrid);

                        }
                    };
                    let baljuParam = {
                        'start': start.val(),
                        'end': end.val(),
                        'action': 'read'
                    };
                    AjaxUtil.getAsyncData(_this.url + '/read_balju', baljuParam, fnsuccess);

                };

                fnLoadBaljuList();

                $content.find('#btnBaljuAction').on('click', function () {

                    let url = _this.url + '/save_balju';
                    let items = _this.baljuInputGrid.rows
                        .filter(row => row.isSelected)
                        .map(row => row.dataItem);

                    console.log(items);

                    if (!items || items.length === 0) {
                        Alert.alert('', 'Ï†ÄÏû•Ìï† Ìï≠Î™©ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.');
                        return;
                    }

                    for (let i = 0; i < items.length; i++) {
                        const row = items[i];

                        if (!row.StoreHouse_id) {
                            Alert.alert('', 'ÎÇ©Ìíà Ï∞ΩÍ≥†Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.');
                            return;
                        }

                        if (row.inputQty === null || row.inputQty === undefined || row.inputQty === '') {
                            Alert.alert('', 'ÏûÖÍ≥† ÏàòÎüâÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
                            return;
                        }

                        // Ï∂îÍ∞Ä: ÏùåÏàò ÎòêÎäî 0 Ï≤¥ÌÅ¨ÎèÑ ÌïÑÏöîÌï† Í≤ΩÏö∞
                        if (isNaN(row.inputQty) || Number(row.inputQty) <= 0) {
                            Alert.alert('', 'ÏûÖÍ≥† ÏàòÎüâÏùÄ 0Î≥¥Îã§ ÌÅ∞ Ïà´ÏûêÏó¨Ïïº Ìï©ÎãàÎã§.');
                            return;
                        }
                    }

                    let fnSuccess = function (res) {
                        if (!res.success) {
                            Alert.alert('', res.message);
                        } else {
                            Notify.success('Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§');
                            page.searchDataBind();
                            modalContainer.modal.close();
                        }
                    };

                    AjaxUtil.postJsonAsyncData(url, items, fnSuccess);
                });

            }

            addMultiDataPopup(type) {
                let _this = this;
                let content = tmpl('addMultiDataPopup', {});
                let $content = $(content);
                //let form = $('#mat_multi_input_form');
                modalContainer = new PopupDraggable('ÌíàÎ™© Îã§Ï§ëÏûÖÍ≥† Îì±Î°ù');

                modalContainer.open({width: 490, height: 620, $content});
                popup = new matMultiInPopup($content);
            }

            showLotInputPopup() {
                let _this = this;
                let items = _this.grid.selectedItems;
                if (items.length === 0) {
                    Alert.alert('Î°úÌä∏ÏûÖÍ≥†Îì±Î°ù', 'ÏÑ†ÌÉùÎêú ÏûÖÍ≥† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ', function () {
                    });
                    return;
                }
                if (items[0].inout_state === 'ÎØ∏ÌôïÏù∏') {
                    Alert.alert('Î°úÌä∏ÏûÖÍ≥†Îì±Î°ù', 'Í∞ÄÏûÖÍ≥† ÏûêÏû¨Îäî Î°úÌä∏ÏûÖÍ≥† Ìï† Ïàò ÏóÜÏäµÎãàÎã§. ', function () {
                    });
                    return;
                }

                if (items[0].lot_use !== 'Y') {
                    Alert.alert('Î°úÌä∏ÏûÖÍ≥†Îì±Î°ù', 'Î°úÌä∏Í¥ÄÎ¶¨ ÏïàÌïòÎäî ÏûêÏû¨Îäî Î°úÌä∏ÏûÖÍ≥† Ìï† Ïàò ÏóÜÏäµÎãàÎã§. ', function () {
                    });
                    return;
                }
                let item = items[0];
                let content = tmpl('lotInputPopup', {});
                let $content = $(content);
                let modalContainer = new PopupDraggable('Î°úÌä∏ÏûÖÍ≥†Îì±Î°ù');
                modalContainer.open({width: 1000, height: 600, $content});

                this.matLotGrid = new wijmo.grid.FlexGrid('#mat-lot-grid', {
                    autoGenerateColumns: false,
                    selectionMode: wijmo.grid.SelectionMode.Row,
                    frozenColumns: 0,
                    frozenRows: 0,
                    headersVisibility: wijmo.grid.HeadersVisibility.All,
                    formatItem: (sender, e) => {
                        if (e.panel.cellType === wijmo.grid.CellType.RowHeader) {
                            // Ìó§ÎçîÏóê ÏàúÎ≤à
                            e.cell.textContent = (e.row + 1).toString();
                        }
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            e.cell.style.textAlign = 'center';

                            // Description Ïó¥ÏóêÎßå Ïä§ÌÉÄÏùº Ï†ÅÏö©
                            if (sender.columns[e.col].binding === 'Description') {
                                e.cell.style.color = '#5567ff'; // Í∏ÄÏûê ÏÉâÍπî Î≥ÄÍ≤Ω
                            }
                        }
                    },
                    columns: [
                        {binding: 'LotNumber', header: 'Î°úÌä∏Î≤àÌò∏', width: 120, align: 'center', isReadOnly: true},
                        {binding: 'UnitName', header: 'Îã®ÏúÑ', width: 70, align: 'center', isReadOnly: true},
                        {binding: 'InputDateTime', header: 'ÏûÖÍ≥†ÏùºÏãú', width: 120, align: 'center', isReadOnly: true},
                        {binding: 'EffectiveDate', header: 'Ïú†Ìö®ÏùºÏãú', width: 120, align: 'center', isReadOnly: true},
                        {binding: 'InputQty', header: 'ÏàòÎüâ', width: 100, align: 'right', isReadOnly: true},
                        {binding: 'Description', header: 'ÎπÑÍ≥†', width: 200, align: 'left', isReadOnly: false}
                    ],
                    itemsSource: new wijmo.collections.CollectionView([])
                });

                new FlexGridContextMenu(this.matLotGrid);
                this.matLotGrid.downloadFileName = 'Î°úÌä∏ ÏûÖÍ≥† ÎÇ¥Ïó≠';

                let $EffectiveDate = $content.find('#EffectiveDate');
                let $MaterialTypeName = $content.find('#MaterialTypeName');
                let $MaterialName = $content.find('#MaterialName');
                let $ValidDays = $content.find('#ValidDays');
                let $StoreHouseName = $content.find('#StoreHouseName');
                let $UnitName = $content.find('#UnitName');
                let $LotSize = $content.find('#LotSize');
                let $mio_pk = $content.find('#mio_pk');
                let $InputQty = $content.find('#InputQty');
                let $btnLotCalc = $content.find('#btnLotCalc');
                let $btnLotSave = $content.find('#btnLotSave');
                let $btnLotRefresh = $content.find('#btnLotRefresh');


                $MaterialTypeName.val(item.material_type);
                $MaterialName.val(item.material_name);
                $mio_pk.val(item.mio_pk);
                $UnitName.val(item.unit_name);
                $LotSize.val(item.PackingUnitQty);
                $StoreHouseName.val(item.store_house_name);
                $InputQty.val(item.InputQty);
                $ValidDays.val(item.ValidDays);
                if (item.ValidDays) {
                    let valDate = CommonUtil.getYYYYMMDD(item.ValidDays);
                    $EffectiveDate.val(valDate);
                }

                let fnLoadLotList = function (mio_pk) {
                    let fnsuccess = function (result) {
                        if (result.data.length > 0) {
                            //$btnLotSave.prop('disabled', 'disabled');
                            $btnLotCalc.prop('disabled', 'disabled');
                        }
                        _this.matLotGrid.itemsSource = new wijmo.collections.CollectionView(result.data);
                    };
                    let lotParam = {
                        mio_id: mio_pk,
                        action: 'mio_lot_list'
                    };
                    AjaxUtil.getAsyncData(_this.url + '/mio_lot_list', lotParam, fnsuccess);

                };

                fnLoadLotList(item.mio_pk);

                // Î°úÌä∏Í≥ÑÏÇ∞Î≤ÑÌäº ÌÅ¥Î¶≠
                $btnLotCalc.click(function (e) {
                    _this.matLotGrid.itemsSource.sourceCollection = [];

                    if ($EffectiveDate.val() === '' || $EffectiveDate.val() == null) {
                        Alert.alert('Î°úÌä∏Ï†ÄÏû•', 'Ïú†Ìö® ÏùºÏãúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', function () {
                        });
                        return;
                    }

                    let inputQty = $InputQty.val();
                    let lotSize = $LotSize.val();
                    let effectedDate = $EffectiveDate.val();

                    if (inputQty === '' || inputQty === 0) {
                        // alert(1);
                        Alert.alert('ÏûÖÍ≥†ÏàòÎüâ', 'ÏûÖÍ≥†ÏàòÎüâÏù¥ ÏóÜÏäµÎãàÎã§.');
                        return;
                    }
                    if (lotSize === '' || lotSize === 0) {
                        // alert(2);
                        Alert.alert('Î°úÌä∏ÎãπÏàòÎüâ', 'Î°úÌä∏Îãπ ÏàòÎüâÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }
                    let lotCount = (inputQty / lotSize);
                    if (lotCount < 1) {
                        // alert(3);
                        Alert.alert('', 'ÏûÖÍ≥†ÏàòÎüâÍ≥º Î°úÌä∏ÎãπÏàòÎüâÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }
                    lotCount = Math.ceil(lotCount);
                    let remainQty = Number(inputQty);
                    let now = CommonUtil.getYYYYMMDD();
                    let updatedCollection = [];

                    for (let idx = 0; idx < lotCount; idx++) {
                        let qty = lotSize;
                        if (remainQty < qty) {
                            qty = remainQty;
                        }
                        let r = {
                            InputQty: qty,
                            UnitName: item.unit_name,
                            InputDateTime: now,
                            Description: item.Description,
                            mio_id: item.mio_pk,
                            EffectiveDate: effectedDate,
                            LotNumber: ''
                        };

                        updatedCollection.push(r);
                        remainQty = remainQty - qty;
                    }
                    _this.matLotGrid.itemsSource.sourceCollection = updatedCollection;
                });

                let $btnBarcordPrint = $content.find('#btnBarcordPrint');

                // Î∞îÏΩîÎìúÏ∂úÎ†•
                $btnBarcordPrint.click(function (e) {
                    let lotItems = _this.matLotGrid.itemsSource.items;
                    if (lotItems.length == 0) {
                        return;
                    }
                    let barcodeItems = [];
                    $.each(lotItems, function (idx, lotItem) {
                        if (lotItem.LotNumber) {
                            barcodeItems.push(lotItem);
                        }
                    });

                    if (barcodeItems.length > 0) {
                        _this.showBarcodePrint(barcodeItems);
                    }
                });

                // Î°úÌä∏Ï†ÄÏû•
                $btnLotSave.click(function (e) {
                    let lotItems = _this.matLotGrid.itemsSource.items;
                    if (lotItems.length === 0) {
                        Alert.alert('Î°úÌä∏Ï†ÄÏû•', 'Ï†ÄÏû•Ìï† Î°úÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§.', function () {
                        });
                        return;
                    }

                    if ($EffectiveDate.val() === '' || $EffectiveDate.val() == null) {
                        Alert.alert('Î°úÌä∏Ï†ÄÏû•', 'Ïú†Ìö® ÏùºÏãúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', function () {
                        });
                        return;
                    }
                    let qty = Number($InputQty.val());
                    let strLots = JSON.stringify(lotItems);
                    let url = _this.url + '/lot_save';
                    let sendData = {
                        mio_id: item.mio_pk,
                        Material_id: item.Material_id,
                        StoreHouse_id: item.StoreHouse_id,
                        Q: strLots
                    };

                    let lotSaveCallback = function (result) {
                        if (result.success) {
                            Notify.success('Ï†ÄÏû•ÌñàÏäµÎãàÎã§.');

                            fnLoadLotList(item.mio_pk);
                        } else {
                            Notify.error('ÏóêÎü¨Í∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                        }
                    };
                    AjaxUtil.postAsyncData(url, sendData, lotSaveCallback);
                });

                // ÏÉàÎ°úÍ≥†Ïπ®
                $btnLotRefresh.click(function (e) {
                    fnLoadLotList(item.mio_pk);
                });
            }

            //ÏûÖÍ≥† Í≤ÄÏÇ¨
            showInputTestPopup() {
                let _this = this;
                let items = _this.grid.selectedItems;
                console.log('items',items);
                if (items.length === 0) {
                    Alert.alert('ÏûÖÍ≥†Í≤ÄÏÇ¨', 'ÏÑ†ÌÉùÎêú ÏûÖÍ≥† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ', function () {
                    });
                    return;
                } else if (items[0].inout_state !== 'ÎØ∏ÌôïÏù∏' && !items[0].judge_code) {
                    Alert.alert('ÏûÖÍ≥†Í≤ÄÏÇ¨', 'ÏàòÏûÖ Í≤ÄÏÇ¨ ÌíàÎ™©Îßå ÏûÖÍ≥†Í≤ÄÏÇ¨ Ìï† Ïàò ÏûàÏäµÎãàÎã§. ', function () {
                    });
                    return;
                }
                let item = items[0];
                let content = tmpl('inputTestPopup', {});
                let $content = $(content);
                let modalContainer = new PopupDraggable('ÏûÖÍ≥†Í≤ÄÏÇ¨');
                modalContainer.open({width: 1000, height: 670, $content});

                this.matTestGrid = new wijmo.grid.FlexGrid('#mat-input-test-grid', {
                    autoGenerateColumns: false,
                    selectionMode: wijmo.grid.SelectionMode.Row,
                    frozenColumns: 0,
                    frozenRows: 0,
                    headersVisibility: wijmo.grid.HeadersVisibility.Column,
                    formatItem: (sender, e) => {
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            e.cell.style.textAlign = 'center';
                            // result1 Ïó¥ÏóêÎßå Ïä§ÌÉÄÏùº Ï†ÅÏö©
                            if (sender.columns[e.col].binding === 'result1') {
                                e.cell.style.color = '#5567ff'; // Í∏ÄÏûê ÏÉâÍπî Î≥ÄÍ≤Ω
                            }
                        }
                    },
                    columns: [
                        {binding: 'name', header: 'Í≤ÄÏÇ¨Ìï≠Î™©', width: 200, align: 'left', isReadOnly: true},
                        {
                            binding: 'result1', header: 'Í≤∞Í≥ºÍ∞í(ÏûÖÎ†•)', width: 400, align: 'center', isReadOnly: false
                        }
                    ],
                    itemsSource: new wijmo.collections.CollectionView([]),
                });

                this.matTestGrid.addEventListener(this.matTestGrid.hostElement, 'click', (e) => {
                    const ht = this.matTestGrid.hitTest(e);
                    if (ht.cellType === wijmo.grid.CellType.Cell) {
                        const col = this.matTestGrid.columns[ht.col];
                        const item = this.matTestGrid.rows[ht.row]?.dataItem;

                        if (col.binding === 'result1' && item.resultType === 'S') {
                            col.isReadOnly = true;
                            // Îç∞Ïù¥ÌÑ∞ Í∞íÏùÑ ÌÜ†Í∏Ä
                            item.result1 = item.result1 === 'O' ? 'X' : 'O';
                            // Î≥ÄÍ≤ΩÎêú Í∞íÏùÑ Î∞òÏòÅ
                            this.matTestGrid.collectionView.refresh();
                        } else {
                            col.isReadOnly = false;
                        }
                    }
                });
                new FlexGridContextMenu(this.matTestGrid);
                this.matTestGrid.downloadFileName = 'ÏûÖÍ≥† Í≤ÄÏÇ¨ ÎÇ¥Ïó≠';

                let $EffectiveDate = $content.find('#EffectiveDate');
                let $MaterialTypeName = $content.find('#MaterialTypeName');
                let $MaterialName = $content.find('#MaterialName');
                let $MaterialCode = $content.find('#MaterialCode');
                let $InoutDate = $content.find('#InoutDate');
                let $InoutTime = $content.find('#InoutTime');
                let $btnTestSave = $content.find('#btnTestSave');
                let $btnAllItem = $content.find('#btnAllItem');
                let $TestDate = $content.find('#TestDate');
                let $TestName = $content.find('#TestName');
                let $judgGroup = $content.find('#judgGroup');
                let $testRemark = $content.find('#testRemark');
                let $inputQty = $content.find('#inputQty');
                let $cboTestMaster = $content.find('#cboTestMaster');
                let $testResultId = $content.find('#testResultId');

                $MaterialTypeName.val(item.material_type);
                $MaterialName.val(item.material_name);
                $MaterialCode.val(item.material_code);
                $InoutDate.val(item.InoutDate);
                $InoutTime.val(item.InoutTime);
                $inputQty.val(item.potentialInputQty);

                if (parseFloat($inputQty.val()) === 0) {
                    $btnTestSave.hide();
                } else {
                    $btnTestSave.show();
                }

                if (item.ValidDays) {
                    let valDate = CommonUtil.getYYYYMMDD(item.ValidDays);
                    $EffectiveDate.val(valDate);
                }
                $TestDate.val(CommonUtil.getYYYYMMDD());
                $TestName.val(userinfo.username);

                AjaxUtil.fillSelectOptions($cboTestMaster, 'test_master', 'choose', false, '', '', 'import');

                // $cboTestMaster.val(12)
                AjaxUtil.fillSelectOptions($judgGroup, 'system_code', 'choose', false, 'judg_code');

                let fnLoadTestList = function (mio_pk) {
                    let fnsuccess = function (result) {
                        if (result.data !== null) {
                            _this.matTestGrid.itemsSource.sourceCollection = result.data.mioList;

                            if (result.data.testDate != null) {
                                $TestDate.val(result.data.testDate);
                            }
                            if (result.data.CheckName != null) {
                                $TestName.val(result.data.CheckName);
                            }

                            if (result.data.EffectiveDate != null) {
                                $EffectiveDate.val(result.data.EffectiveDate)
                            }

                            if (result.data.testResultId != null) {
                                $testResultId.val(result.data.testResultId)
                            }

                            if (result.data.testMasterId != null) {
                                $cboTestMaster.val(result.data.testMasterId).prop("disabled", true);
                            } else {
                                $cboTestMaster.val("").prop("disabled", true); // Í≤ÄÏÇ¨ Ïú†ÌòïÏù¥ ÏóÜÏúºÎ©¥ ÎπÑÌôúÏÑ±Ìôî
                            }
                            $judgGroup.val(result.data.JudgeCode);
                            $testRemark.val(result.data.CharResult);
                        }
                    };
                    let testParam = {
                        mio_id: mio_pk,
                        test_result_id: $testResultId.val(),
                        action: 'mio_test_list'
                    };
                    AjaxUtil.getAsyncData(_this.url + '/mio_test_list', testParam, fnsuccess);

                };

                fnLoadTestList(item.mio_pk);

                $btnAllItem.click(function (e) {
                    _this.matTestGrid.itemsSource.sourceCollection.forEach(function (item) {
                        if (item.resultType === 'S') {
                            item.result1 = 'O';
                        }
                    });
                    _this.matTestGrid.collectionView.refresh();
                })
                // ÏûÖÍ≥†Í≤ÄÏÇ¨ Ï†ÄÏû•
                $btnTestSave.click(function (e) {
                    let testItems = _this.matTestGrid.itemsSource.sourceCollection;

                    if (testItems.length === 0) {
                        Alert.alert('Í≤ÄÏÇ¨Ï†ÄÏû•', 'Ï†ÄÏû•Ìï† ÏûÖÍ≥†ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.', function () {
                        });
                        return;
                    }

                    if ($cboTestMaster.val() === '') {
                        Alert.alert('Í≤ÄÏÇ¨Ï†ÄÏû•', 'Í≤ÄÏÇ¨Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.', function () {
                        });
                        return;
                    }

                    if(!$judgGroup.val()){
                        Alert.alert('Í≤ÄÏÇ¨Ï†ÄÏû•', 'Ï¢ÖÌï© ÌåêÏ†ïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.', function () {
                        });
                        return;
                    }

                    let url = _this.url + '/test_save';
                    let sendData = {
                        mio_id: item.mio_pk,
                        test_mast_id: $cboTestMaster.val(),
                        test_result_id: $testResultId.val(),
                        test_date: $TestDate.val(),
                        judg_grp: $judgGroup.val(),
                        material_id: item.Material_id,
                        testRemark: $testRemark.val(),
                        effective_date: $EffectiveDate.val(),
                        Q: JSON.stringify(testItems)
                    };

                    let testSaveCallback = function (result) {
                        if (result.success) {
                            Notify.success('Ï†ÄÏû•ÌñàÏäµÎãàÎã§.');
                            $content.find('#modal-close-button').click();
                            page.searchDataBind()
                        } else {
                            Notify.error('ÏóêÎü¨Í∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                        }
                    };
                    AjaxUtil.postAsyncData(url, sendData, testSaveCallback);
                });
            }

            showBarcodePrint(barcodeItems) {

                let _this = this;
                let content = tmpl('barcode_tmpl', {});
                let $content = $(content);
                let modalContainer = new PopupDraggable('Î∞îÏΩîÎìú Ï∂úÎ†•');
                modalContainer.open({width: 470, height: 700, $content});
                let $barcodeDiv = $content.find('#barcodeDiv');

                $.each(barcodeItems, function (idx, item) {
                    let svg_id = "barcode_" + item.LotNumber;
                    let svg = "<div class='col-12'><svg id='" + svg_id + "'></svg></div>";

                    let tmp_table = tmpl('barcode_table_tmpl', item);
                    let $tmp_table = $(tmp_table);
                    $tmp_table.find('.barcode_td').append(svg);

                    $barcodeDiv.append($tmp_table);
                });

                $.each(barcodeItems, function (idx, item) {
                    let svg_id = "#barcode_" + item.LotNumber;

                    // use options
                    JsBarcode(svg_id, item.LotNumber, {
                        format: 'code128', // Î∞îÏΩîÎìú Ìè¨Îß∑ / default: code128 / options: EAN, UPC, CODE39, ITF-14, MSI, Pharmacode, Codabar (Í∞Å ÏòµÏÖòÎì§Ïóê ÎåÄÌïú ÏÑ§Î™ÖÏùÄ ÏÇ¨Ïù¥Ìä∏ Ï∞∏Ï°∞)
                        width: 2, // ÎÑàÎπÑ / default: 2
                        height: 100, // ÎÜíÏù¥ / default: 100
                        displayValue: true, // ÌÖçÏä§Ìä∏ ÌëúÏãú Ïó¨Î∂Ä / default: true
                        text: item.LotNumber, // Îç∞Ïù¥ÌÑ∞ ÎåÄÏã† ÌäπÏ†ï ÌÖçÏä§Ìä∏ ÌëúÏãú / default: undefined
                        fontOptions: '', // Ìè∞Ìä∏ ÏÑ§Ï†ï / default: '' / options: bold, italic, bold italic
                        font: 'monospace', // Ìè∞Ìä∏ / default: monospace / options: fantasy, etc... ÏÇ¨Ïù¥Ìä∏ Ï∞∏Ï°∞
                        textAlign: 'center', // ÌÖçÏä§Ìä∏ ÏúÑÏπò / default: center / options: left, center, right
                        textPosition: 'bottom', // ÌÖçÏä§Ìä∏ ÏúÑÏπò / default: bottom / options: top, bottom
                        textMargin: 2, // Î∞îÏΩîÎìúÏôÄ ÌÖçÏä§Ìä∏ ÏÇ¨Ïù¥ Ïó¨Î∞± / default: 2
                        fontSize: 20, // Ìè∞Ìä∏ ÌÅ¨Í∏∞ / default: 20
                        background: '#ffffff', // Î∞îÏΩîÎìú Î∞∞Í≤Ω ÏÉâ / default: #ffffff
                        lineColor: '#000000', // Î∞îÏΩîÎìú ÎùºÏù∏ ÏÉâ / default: #000000
                        margin: 10, // Î∞îÏΩîÎìú ÏòÅÏó≠ Ï£ºÎ≥Ä Ïó¨Î∞± / default: 10
                    });
                });

                let $btnPopPrintBarcode = $content.find('#btnPopPrintBarcode');

                // Î∞îÏΩîÎìú Ïù∏ÏáÑ Î≤ÑÌäº ÌÅ¥Î¶≠
                $btnPopPrintBarcode.click(function (e) {
                    var popupWindow = window.open("barcode_print", "_blank", "width=400px");
                    let css = $('#print_css')[0].outerHTML;

                    let html = $barcodeDiv.html();
                    popupWindow.document.write(css);
                    popupWindow.document.write(html);
                    popupWindow.print();
                });
            }
        }

        class materialInoutPopup {
            constructor() {
                this.grid = null;
                this.init();
            }

            init() {
                let _this = this;
            }

            saveData(type, form) {

                let url = '/api/inventory/material_inout/save';
                let data = FormUtil.extractForm($('#materialInoutForm'));
                data['type'] = type;
                let fnSuccess = function (res) {
                    if (!res.success) {
                        Alert.alert('', res.message);
                    } else {
                        Notify.success('Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§');
                        page.searchDataBind();
                    }
                };

                AjaxUtil.postAsyncData(url, data, fnSuccess);
            }
        }


        class matMultiInPopup {
            constructor($content) {
                this.grid = null;

                this.$content = $content;
                this.init();
            }

            init() {
                let _this = this;
                let $content = this.$content;

                // Îã§Ï§ëÏûÖÍ≥† Í∑∏Î¶¨Îìú ÌåùÏóÖ
                this.grid = new wijmo.grid.FlexGrid('#multi_input_grid', {
                    autoGenerateColumns: false,
                    selectionMode: wijmo.grid.SelectionMode.None,
                    headersVisibility: wijmo.grid.HeadersVisibility.Column,
                    frozenColumns: 0,
                    frozenRows: 0,
                    isReadOnly: true,
                    formatItem: (sender, e) => {
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            e.cell.style.textAlign = 'center';
                        }
                    },
                    columns: [
                        {binding: 'mat_code', header: 'ÌíàÎ™©ÏΩîÎìú', width: 100, align: 'center'},
                        {binding: 'mat_name', header: 'ÌíàÎ™©Î™Ö', width: 200, align: 'left'},
                        {binding: 'input_qty', header: 'ÏàòÎüâ', width: 100, align: 'right', format: 'n0'}
                    ],
                    itemsSource: new wijmo.collections.CollectionView([]),
                    itemFormatter: (panel, row, col, cell) => {
                        if (panel.cellType === wijmo.grid.CellType.Cell) {
                            const item = panel.rows[row].dataItem; // ÌòÑÏû¨ ÌñâÏùò Îç∞Ïù¥ÌÑ∞ Ìï≠Î™©
                            const column = panel.columns[col]; // ÌòÑÏû¨ Ïó¥ Ï†ïÎ≥¥

                            // ÌíàÎ™©Î™Ö Ï°∞Í±¥Î∂Ä Ïä§ÌÉÄÏùºÎßÅ
                            if (column.binding === 'mat_name' && (!item.mat_name || item.mat_name.trim() === '')) {
                                cell.classList.add('grid-cell-red'); // 'grid-cell-red' ÌÅ¥ÎûòÏä§Î•º Ï∂îÍ∞Ä
                            }
                        }
                    }
                });
                new FlexGridContextMenu(this.grid);
                this.grid.downloadFileName = 'Îã§Ï§ë ÏûÖÍ≥† ÎÇ¥Ïó≠';

                AjaxUtil.fillSelectOptions($content.find('#StoreHouse_id'), 'store_house', 'choose', 3);    // 3:ÏûêÏû¨Ï∞ΩÍ≥†
                $content.find('#dialog_title').innerHTML = 'ÌíàÎ™©ÏûÖÍ≥† Îì±Î°ù';
                AjaxUtil.fillSelectOptions($content.find('#InoutType'), 'system_code', '', 'order_in', 'input_type');
                AjaxUtil.fillSelectOptions($content.find('#Company_id'), 'company', 'choose', '', 'purchase');
                $content.find('#cboMaterialGroup').on('change', function (e) {
                    let mat_group = $content.find('#cboMaterialGroup').val();
                    AjaxUtil.fillSelectOptions($content.find('#Material_id'), 'material', 'choose', '', mat_group);
                });

                $content.find('#btnTextToGrid').on('click', function () {
                    _this.checkMultiData();
                    return;
                });
                $content.find('#btnSaveMultiData').on('click', function () {
                    popup.saveMultiData();
                    //modalContainer.modal.close();
                });

                $content.find('a[name=tab_copy_text]').trigger('click');
                // $content.find('#tab_copy_text').attr("data-tablink")).addClass("hidden");
            }

            getListFromText() {
                let _this = this;
                let $content = this.$content;
                let copyText = $content.find("#txtCopyText").val();
                let line = copyText.split('\n');
                let items = [];
                for (let i = 0; i < line.length; i++) {
                    let data = line[i].split('\t');
                    let mat_code = data[0];
                    let input_qty = data[1];
                    items.push({'mat_code': mat_code, 'input_qty': input_qty});
                }
                return items;
            }

            copyToGrid() {
                let _this = this;
                let $content = this.$content;
                this.grid.itemsSource.sourceCollection = [];  // grid Ï¥àÍ∏∞Ìôî
                let copyText = $content.find("#txtCopyText").val();
                let line = copyText.split('\n');
                for (let i = 0; i < line.length; i++) {
                    let data = line[i].split('\t');
                    let mat_code = data[0];
                    let input_qty = data[1];
                    if (mat_code === '' || input_qty === '') {
                        line.splice(i, 1);
                        continue;
                    }
                    _this.grid.addRow($.extend({}, {'mat_code': mat_code, 'input_qty': input_qty}), "last");
                }
            }

            checkMultiData() {
                let _this = this;
                let url = '/api/inventory/material_inout';
                let grid_data = this.getListFromText();
                let data = {
                    action: 'trans_multi_input_data',
                    Q: JSON.stringify(grid_data)
                };
                let result = AjaxUtil.getSyncData(url + "/trans_multi_input_data", data);
                if (result) {
                    _this.grid.itemsSource.sourceCollection = result.data;
                }
            }

            saveMultiData() {

                let url = '/api/inventory/material_inout/save_multi_data';
                let data = FormUtil.extractForm($('#mat_multi_input_form'));
                data['type'] = 'in';
                let grid_data = this.grid.itemsSource.sourceCollection;
                let bad_count = 0;
                grid_data.forEach(function (value, index) {
                    if (!value.mat_name)
                        bad_count++;
                });
                if (bad_count > 0) {
                    Alert.alert('ÌíàÎ™©ÏΩîÎìú ÌôïÏù∏', 'ÌíàÎ™©Î™Ö ÏóÜÎäî ÌíàÎ™©ÏΩîÎìúÍ∞Ä ÏûàÏäµÎãàÎã§.');
                    return false;
                }

                data['Q'] = JSON.stringify(grid_data);

                let res = AjaxUtil.postSyncData(url, data);
                console.log('data', data);
                if (!res.success) {
                    Alert.alert('', res.message);
                    return false;
                } else {
                    Notify.success('Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§');
                    page.searchDataBind();
                    modalContainer.modal.close();
                }
            }
        }


        class MaterialMove {
            constructor() {
                this.grid = null;
            }

            initGrid(gridElement) {
                this.grid = new wijmo.grid.FlexGrid(gridElement, {
                    autoGenerateColumns: false,
                    selectionMode: wijmo.grid.SelectionMode.ListBox,
                    headersVisibility: wijmo.grid.HeadersVisibility.All,
                    formatItem: (sender, e) => {
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            e.cell.style.textAlign = 'center';
                        }
                    },
                    columns: [
                        {binding: 'mat_type', header: 'ÌíàÎ™©Íµ¨Î∂Ñ', width: 100, align: 'center', isReadOnly: true},
                        {binding: 'mat_code', header: 'ÌíàÎ™©ÏΩîÎìú', width: 100, align: 'left', isReadOnly: true},
                        {binding: 'material', header: 'ÌíàÎ™©', width: 250, align: 'left', isReadOnly: true},
                        {binding: 'unit_name', header: 'Îã®ÏúÑ', width: 100, align: 'center', isReadOnly: true},
                        {binding: 'current_stock', header: 'Ï∞ΩÍ≥†Ïû¨Í≥†', width: 100, align: 'right', isReadOnly: true},
                        {binding: 'move_qty', header: 'Ïù¥ÎèôÎüâ(ÏûÖÎ†•ÏàòÏ†ï)', width: 150, align: 'right', isReadOnly: false}
                    ],
                    itemsSource: new wijmo.collections.CollectionView([]),
                    itemFormatter: (panel, row, col, cell) => {
                        if (panel.cellType === wijmo.grid.CellType.Cell) {
                            const item = panel.rows[row].dataItem; // ÌòÑÏû¨ ÌñâÏùò Îç∞Ïù¥ÌÑ∞ Ìï≠Î™©
                            const column = panel.columns[col]; // ÌòÑÏû¨ Ïó¥ Ï†ïÎ≥¥

                            // Ï∞ΩÍ≥†Ïû¨Í≥† Ï°∞Í±¥Î∂Ä Ïä§ÌÉÄÏùºÎßÅ
                            if (column.binding === 'house_stock' && item.house_stock <= 0) {
                                cell.classList.add('grid-cell-red'); // 'grid-cell-red' ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                            }

                            // Ïù¥ÎèôÎüâ Ï°∞Í±¥Î∂Ä Ïä§ÌÉÄÏùºÎßÅ
                            if (column.binding === 'move_qty') {
                                if (item.move_qty > 0) {
                                    cell.classList.add('grid-cell-blue'); // 'grid-cell-blue' ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                                }
                            }
                        }
                    }
                });
                let selector = new wijmo.grid.selector.Selector(this.grid, {
                    itemChecked: function () {

                    }
                })
                new FlexGridContextMenu(this.grid);
                this.grid.downloadFileName = 'ÌíàÎ™© ÎÇ¥Ïó≠';
            }

            searchMaterial() {
                let _this = this;

                let from = this.$cboFrom.val();
                let to = this.$cboTo.val();
                let material_id = this.$cboMaterial.val();

                let url = '/api/inventory/material_move';
                let data = {
                    action: 'read',
                    storehouse_id: from,
                    material_id: material_id
                };

                let fnsuccess = function (result) {
                    if (result.data) {
                        _this.grid.itemsSource.sourceCollection = result.data;
                    }
                };

                AjaxUtil.getAsyncData(url + "/read", data, fnsuccess);

                return true;
            }

            checkMoveValidation() {

                let _this = this;
                let from = this.$cboFrom.val();
                let to = this.$cboTo.val();

                let items = [];
                let strItems = JSON.stringify(items);

                if (from === '' || to === "") {
                    Alert.alert('', 'from, toÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.');
                    return;
                }
                if (from === to) {
                    Alert.alert('', 'ÎèôÏùºÌïú Ï∞ΩÍ≥†Î•º ÏÑ†ÌÉùÌïòÏÖ®ÏäµÎãàÎã§.');
                    return;

                }

                let seletectedItems = _this.grid.selectedItems;
                if (seletectedItems.length === 0) {
                    Alert.alert('', 'ÏÑ†ÌÉùÎêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                    return;
                }

                $.each(seletectedItems, function (idx, item) {
                    let move_qty = item.move_qty;
                    if (move_qty > 0) {
                        items.push({material_id: item.id, move_qty: move_qty});
                    }
                });

                if (items.length === 0) {
                    Alert.alert('', 'Ïù¥ÎèôÏàòÎüâ Î≥ÄÍ≤ΩÏù¥ ÏóÜÏäµÎãàÎã§.');
                    return false;
                }

                return true;

            }

            moveMaterial() {

                let _this = this;
                if (this.checkMoveValidation() === false) {
                    return false;
                }

                let from = this.$cboFrom.val();
                let to = this.$cboTo.val();
                let items = [];

                let seletectedItems = _this.grid.selectedItems;
                if (seletectedItems.length === 0) {
                    Alert.alert('', 'ÏÑ†ÌÉùÎêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                    return;
                }

                $.each(seletectedItems, function (idx, item) {
                    let move_qty = item.move_qty;
                    if (move_qty > 0) {
                        items.push({
                            mat_id: item.mat_id,
                            move_qty: move_qty,
                            storehouse_id: from
                        });
                    }
                });

                let strItems = JSON.stringify(items);
                let url = '/api/inventory/material_move/material_move';
                let data = {
                    from_storehouse_id: from,
                    to_storehouse_id: to,
                    move_list: strItems
                };
                let fnsuccess = function (result) {
                    if (result.success) {
                        Notify.success('Ïù¥ÎèôÎêòÏóàÏäµÎãàÎã§.');
                        _this.modalContainer.close();
                        page.searchDataBind();
                    } else {
                        Alert.alert('', 'Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                    }
                };

                AjaxUtil.postAsyncData(url, data, fnsuccess);
            }

            showMovePopup() {

                let _this = this;
                let defaultData = {};
                let content = tmpl('matMovePopup', defaultData);
                let $content = $(content);
                this.modalContainer = new PopupDraggable('ÌíàÎ™© Ï∞ΩÍ≥†Ïù¥Îèô');
                this.modalContainer.open({width: 1000, height: 580, $content});

                this.$cboFrom = $content.find('#cboFrom');
                this.$cboTo = $content.find('#cboTo');
                this.$cboMaterialType = $content.find('#cboMaterialType');
                this.$cboMaterial = $content.find('#cboMaterial');
                this.$moveQuantity = $content.find('#moveQuantity');

                // Í∑∏Î¶¨Îìú ÏÑ§Ï†ï
                let $grid = $content.find('#material-grid');
                this.initGrid($grid);

                AjaxUtil.fillSelectOptions(this.$cboFrom, 'store_house', '', false);
                AjaxUtil.fillSelectOptions(this.$cboTo, 'store_house', '', false);

                let matType = this.$cboMaterialType.val();
                //AjaxUtil.fillSelectOptions(this.$cboMaterial, 'product_semi', 'choose', false, matType);
                AjaxUtil.fillSelectOptions(this.$cboMaterial, 'material', 'choose', false, '', '', matType);

                let $btnMatSearch = $content.find('#btnMatSearch');
                let $btnMoveAction = $content.find('#btnMoveAction');
                _this.searchMaterial();

                $btnMatSearch.click(function (e) {
                    _this.searchMaterial();
                });

                $btnMoveAction.click(function (e) {
                    if (_this.checkMoveValidation()) {
                        Alert.confirm('', 'Ïù¥ÎèôÌïòÏãúÍ≤†ÏäµÎãàÍπå?', function () {
                            _this.moveMaterial();
                        });
                    }
                });

                this.$cboFrom.on('change', function (e) {
                    return _this.searchMaterial();
                });

                this.$cboMaterial.on('change', function (e) {
                    let mat = $(this).val();
                    if (mat === '') {
                        _this.$moveQuantity.val('');
                    }
                });

                this.$cboMaterialType.on('change', function (e) {
                    let matType = _this.$cboMaterialType.val();
                    AjaxUtil.fillSelectOptions(_this.$cboMaterial, 'material', 'choose', false, '', '', matType);
                });

            }
        }


        let page = null;
        let popup = null;
        let modalContainer = null;

        $(document).ready(function (e) {
            page = new materialStorehouse();

            $('#searchForm').find('#srchStartDt').val(CommonUtil.getYYYYMMDD(-7));
            $('#searchForm').find('#srchEndDt').val(CommonUtil.getYYYYMMDD());

            AjaxUtil.fillSelectOptions($('#searchForm').find('#cboHouse'), 'store_house', 'all');
            AjaxUtil.fillSelectOptions($('#cboMatType'), 'system_code', 'all', false, 'mat_type');
            AjaxUtil.fillSelectOptions($('#cboMatGroup'), 'material_group', 'all', false);

            $('#cboMatType').on('change', function (e) {
                let mat_type = $('#cboMatType').val();
                AjaxUtil.fillSelectOptions($('#cboMatGroup'), 'material_group', 'all', false, mat_type);
            });

            // Í≤ÄÏÉâ
            $('#btnSearch').click(function (e) {
                page.searchDataBind();
            });
            $('#searchForm').find('#cboHouse').change(function (e) {
                page.searchDataBind();
            });
            $('#btnInput').on('click', function () {
                page.addDataPopup('in');
                AjaxUtil.fillSelectOptions($('#InoutType'), 'system_code', '', 'etc_in', 'input_type');
            });

            $('#btnOutput').on('click', function () {
                page.addDataPopup('out');
                AjaxUtil.fillSelectOptions($('#InoutType'), 'system_code', '', 'etc_out', 'output_type');
            });

            $('#btnDisposal').on('click', function () {
                page.addDataPopup('out');
                AjaxUtil.fillSelectOptions($('#InoutType'), 'system_code', '', 'disposal_out', 'output_type');
                $('#trCompany').hide();
            });

            $('#btnMultiInput').on('click', function () {
                page.addMultiDataPopup('in');
            });
            // Î∞úÏ£ºÏûÖÍ≥†
            $('#btnBaljuInput').on('click', function () {
                page.showBaljuInputPopup();
            });

            // ÌíàÎ™© Ï∞ΩÍ≥†Ïù¥Îèô ÌåùÏóÖ ÏÉùÏÑ±
            $('#btnShowMovePopup').click(function (e) {
                let movePopupPage = new MaterialMove();
                movePopupPage.showMovePopup();
            });

            page.searchDataBind();

            $('#searchForm').on('submit', function (e) {
                e.preventDefault(); // Í∏∞Î≥∏ Ï†úÏ∂ú ÎßâÍ∏∞
                $('#btnSearch').click(); // Í≤ÄÏÉâ Î≤ÑÌäº Ìä∏Î¶¨Í±∞
            });


        })


    </script>
</th:block>
</html>
