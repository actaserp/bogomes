<th:block th:fragment="popup_invoice">
<th:block th:replace="/common/popup_totalAmount :: popup_totalAmount"></th:block>
<th:block th:replace="/common/popup_account_subject :: popup_account_subject"></th:block>
<th:block th:replace="/common/popup_project :: popup_project"></th:block>
<th:block th:replace="/common/popup_depart :: popup_depart"></th:block>
    <head>
        <style id="invoice_css">

            #InvoiceeCorpNum::placeholder {
                font-size: 13px; /* 원하는 크기로 */
                text-align: left;
            }

            #account_code::placeholder {
                font-size: 13px; /* 원하는 크기로 */
            }

            #att_depart::placeholder {
                font-size: 13px; /* 원하는 크기로 */
            }

            #project::placeholder {
                font-size: 13px; /* 원하는 크기로 */
            }



            .content_wrap.popup {
                overflow-y: auto;
            }

            #taxForm {
                display: flex;
            }

            .border_red {
                border: 2px solid #ef7070;
            }

            table {
                border: none;
            }

            #taxtype_area {
                width: 100%;
                border-top: 2px solid #a5a5a5;
                background-color: #fafafa;
            }

            #taxtype_area .taxtype .taxtype_radio p {
                float: left;
                padding: 8px 25px 12px 25px;
                color: #555;
            }

            #taxtype_area .taxtype .taxtype_radio span {
                float: left;
                padding: 7px 0 12px 0;
            }

            #taxtype_area .taxtype .taxtype_radio span label {
                color: #555;
            }

            #taxtype_area .taxtype .taxtype_radio label.for {
                curosr: pointer;
                padding-left: 3px;
            }

            #taxtype_area .taxtype .client_radio {
                float: left;
                margin: 0 0 0 31px;
            }

            #taxtype_area .taxtype .client_radio p {
                float: left;
                padding: 8px 19px 12px 19px;
                color: #555;
            }

            #taxtype_area .taxtype .client_radio span {
                float: left;
                padding: 7px 0 12px 0;
            }

            #taxtype_area .taxtype .client_radio span label {
                color: #555;
            }

            #taxtype_area .taxtype .client_radio label.for {
                curosr: pointer;
                padding-left: 3px;
            }

            #taxTotalList .PT label.for {
                curosr: pointer;
                padding-left: 3px;
            }

            #WriteTypeList .for {
                margin-left: 5px;
            }

            .rad {
                width: 13px;
                height: 13px;
                margin-bottom: 1px;
                vertical-align: middle;
                cursor: pointer;
            }

            .PT .pt1 {
                float: left;
                margin: 16px 0 0 19%;
            }

            .PT .pt2 {
                float: left;
                margin: 16px 0 0 12px;
            }

            .PT .pt_s {
                float: left;
                margin: 0 0 0 12px;
            }

            #area_form textArea {
                overflow: hidden;
            }

            #area_form {
                float: left;
            }

            table th {
                background-color: white;
            }

            #area_form #etax_area_form .etax_table {
                width: 100%;
                border-spacing: 0px 0px;
                table-layout: fixed;
            }

            .etax_table input,
            .etax_table button {
                max-width: 99%;
                box-sizing: border-box;
                font-weight: 500;
            }

            .etax_table button {
                font-size: 13px;
            }

            #taxList .in_txt {
                height: 35px !important;
            }

            table td {
                border: none;
            }

            #area_form #etax_area_form .etax_table th {
                font-weight: normal;
                padding-top: 2px;
                padding-bottom: 2px;
                line-height: 15px;
                height: 30px;
                border-bottom: none;
            }

            #area_form #etax_area_form .etax_table th, x:-moz-any-link, x:default {
                height: 25px;
                *height: 20px;
            }

            #area_form #etax_area_form .etax_table td {
                color: #333333;
                padding-top: 1px;
                padding-bottom: 3px;
                height: 20px;
                text-align: left;
            }

            #area_form #etax_area_form .etax_table td input.in_txt {
                margin: 2px 0px 0px 0px;
            }

            #area_form #etax_area_form .etax_table td textarea {
                float: left;
                margin: 2px 0px 0px 0px;
                resize: none;
                height: 35px;
            }

            #area_form #etax_area_form .etax_table td, x:-moz-any-link, x:default {
                height: 25px;
                *height: 20px;
            }

            #area_form #etax_area_form .table_border_red th {
                color: #e62324;
            }

            #area_form #etax_area_form .table_border_blue th {
                color: #3070ad;
            }

            #etax_area_form .table_border_red tbody th {
                border-top: 1px solid #f58c8c;
                border-left: 1px solid #f58c8c;
            }

            #etax_area_form .table_border_red tbody th.invoicer_bg {
                background-color: #fff6f6;
            }

            #etax_area_form .table_border_red tbody td {
                border-top: 1px solid #f58c8c;
                border-left: 1px solid #f58c8c;
            }


            #etax_area_form .table_border_red tbody th.splitline {
                padding: 0 0 0 0 !important;
                height: 0 !important;
            }

            #etax_area_form .table_border_blue tbody th {
                border-top: 1px solid #5b9adf;
                border-left: 1px solid #5b9adf;
            }

            #etax_area_form .table_border_blue tbody th.invoicer_bg {
                background-color: #f0f6fd;
            }

            #etax_area_form .table_border_blue tbody td {
                border-top: 1px solid #5b9adf;
                border-left: 1px solid #5b9adf;
            }

            #etax_area_form .table_border_blue tbody th.splitline {
                padding: 0 0 0 0 !important;
                height: 0 !important;
            }


            #area_form #etax_area_form .etax_table .item_border {
                border-top: 1px solid #dfdfdf;
                border-left: 1px solid #dfdfdf;
            }

            #area_form #etax_area_form .etax_table .item_l_border {
                border-left: 1px solid #dfdfdf;
            }

            #area_form #etax_area_form .etax_table .item_t_border {
                border-top: 1px solid #dfdfdf;
            }

            .gray_bg {
                background-color: #f1f3f6;
            }

            .invoicee_blue {
                color: #0071c9;
            }

            input[type="radio"]:checked::after {
                content: "";
                position: absolute;
                top: 3px;
                left: 3px;
                width: 8px;
                height: 8px;
                background: rgb(255, 255, 255);
                border-width: 6px;
                border-style: solid;
                border-color: rgb(36, 124, 255);
                border-image: initial;
                border-radius: 100%;
                margin-right: 5px;
            }


            .in_txt, .txt_ar {
                height: 28px;
                padding: 0 6px;
                border-radius: 0;
                font-size: 14px;
                width: 100%;
            }

            .mgl {
                margin-left: 20px;
            }

            .border_collapse {
                border-collapse: separate;
            }

            .placeholder {
                color: #aaa !important;
            }

            .n_linethrough {
                text-decoration: none !important;
            }

            .linethrough {
                text-decoration: line-through;
            }

            .default {
                cursor: default;
            }

            .hand {
                cursor: pointer;
                cursor: hand;
            }

            .block {
                display: block !important;
            }

            .none {
                display: none !important;
            }

            .show {
                visibility: visible !important;
            }

            .hide {
                visibility: hidden !important;
            }

            .t_hide {
                display: none;
            }

            /* Layout */
            .val_t {
                vertical-align: top;
            }

            .val_m {
                vertical-align: middle;
            }

            .val_b {
                vertical-align: bottom;
            }

            .position_s {
                position: static !important;
            }

            .position_a {
                position: absolute !important;
            }

            .position_r {
                position: relative !important;
            }

            .fl_l {
                float: left !important;
            }

            .fl_r {
                float: right !important;
            }

            .fl_n {
                float: none !important;
            }

            .cr_l {
                clear: left;
            }

            .cr_r {
                clear: right;
            }

            .cr_b {
                clear: both;
            }

            .inline {
                display: inline !important;
            }

            .inline_b {
                display: inline-block !important;
            }

            .t_inline {
                display: inline
            }

            /* Color */
            .red {
                color: #FF0000 !important;
            }

            .red2 {
                color: #ff4b4b !important;
            }

            .leeRed {
                color: #e13a40 !important;
            }

            .blue {
                color: #0071c9 !important;
            }

            .blue2 {
                color: #0071c9 !important;
            }

            .blue3 {
                color: #0071c9 !important;
            }

            .white {
                color: #FFFFFF !important;
            }

            .green {
                color: #00817b !important;
            }

            .green2 {
                color: #299296 !important;
            }

            .gray {
                color: #999999 !important;
            }

            .gray_deep {
                color: #777 !important;
            }

            .gray2 {
                color: #666666 !important;
            }

            .darkgray {
                color: #444444 !important;
            }

            .lgray {
                color: #BBBBBB !important;
            }

            .black {
                color: #000000 !important;
            }

            .orange {
                color: #F8700D !important;
            }

            .purple {
                color: #A566FF !important;
            }

            .redclay {
                color: #fd8316 !important;
            }

            .highlight {
                color: #FF0000 !important;
            }

            .h_blue {
                color: #2881c6 !important;
            }

            .c_333 {
                color: #333 !important;
            }

            .c_555 {
                color: #555 !important;
            }

            .c_777 {
                color: #777 !important;
            }

            .c_999 {
                color: #999 !important;
            }


            /* Table no border */
            .noborder_l {
                border-left: 0px !important;
            }

            .noborder_r {
                border-right: 0px !important;
            }

            .noborder_t {
                border-top: 0px !important;
            }

            .noborder_b {
                border-bottom: 0px !important;
            }

            .bg_none {
                background: none !important;
            }

            .wbr { /*word-break;break-all;*/
                word-wrap: break-word;
            }

            .over_y_h {
                overflow-y: hidden;
                margin: 0 0 0 0;
            }

            .over_x_h {
                overflow-x: hidden;
            }

            .over_y_nh {
                overflow-y: scroll;
                padding: 0;
            }

            /* box-sizing */
            .border_box {
                box-sizing: border-box;
            }

            .btn_white_gradient {
                height: 28px;
                padding: 4px 6px;
                border-radius: 1px;
            }

            .ft_24 {
                font-size: 24px;
            }

            .al_r {
                text-align: right !important;
            }

            .al_l {
                text-align: left !important;
                padding: 3px;
            }

            .pdl_3 {
                padding-right: 3px !important;
            }

            .al_c {
                text-align: center;
            }

            .in_btn {
                height: 28px;
                width: 28px;
                padding: 4px 6px;
                line-height: 36px;
                border-radius: 1px;
            }

            .in_btn img {
                margin-right: 0;
                width: 14px;
                height: 14px;
            }

            .plus img {
                margin-right: 0;
                width: 10px;
                height: 10px;
            }

            .align-center-wrap {
                display: flex;
                align-items: center; /* 세로 가운데 정렬 */
            }

            .align-center-wrap textarea {
                flex: 1;
            }

            .align-center-wrap .btn {
                margin-left: 4px;
            }

        </style>
    </head>
    <script type="text/x-tmpl" id="popup_invoiceTemplate">

        <div class="content_wrap popup">

                <form id="taxForm">
                <div class="section-top">
                        <input type="hidden" id="misnum" name="misnum" >
                        <input type="hidden" id="ChargeDirection" name="ChargeDirection" value="정과금">
                        <input type="hidden" id="IssueType" name="IssueType" value="정발행">
                        <input type="hidden" id="ModifyCode" name="ModifyCode" >
                        <div id="taxtype_area">
                            <div class="taxtype">
                                <div class="taxtype_radio">
                                    <p class="taxtype_icon bold">과세형태</p><span class="fl_l bold pdt_8 c_555">:</span>
                                    <span class="mgl"><input checked="checked" class="rad" type="radio" value="과세" id="TaxType1" name="TaxType"><label class="for" for="TaxType1">과세(10%)</label></span>
                                    <span class="mgl"><input class="rad" type="radio" value="영세" id="TaxType2" name="TaxType"><label class="for" for="TaxType2">영세(0%)</label></span>
                                    <span class="mgl"><input class="rad" type="radio" value="면세" id="TaxType3" name="TaxType"><label class="for" for="TaxType3">면세(세액없음)</label></span>
                                </div>
                                <div class="taxtype_radio"> <p style="margin-left: 40px;">|</p> </div>
                                <div class="client_radio">
                                    <p class="taxtype_icon bold">거래처유형</p><span class="fl_l bold c_555 mg_0 pdt_8">:</span>
                                    <span class="mgl"><input checked="checked" class="rad" type="radio" value="사업자" id="InvoiceeType1" name="InvoiceeType"><label class="for" for="InvoiceeType1">사업자</label></span>
                                    <span class="mgl"><input class="rad" type="radio" value="개인" id="InvoiceeType2" name="InvoiceeType"><label class="for" for="InvoiceeType2">개인</label></span>
                                    <span class="mgl"><input class="rad" type="radio" value="외국인" id="InvoiceeType3" name="InvoiceeType"><label class="for" for="InvoiceeType3">외국인</label></span>
                                </div>
                            </div>
                        </div>

                    <div class="container-fluid">
                        <div id="area_form">
                            <div id="etax_area_form" class="border_red">
                                <table class="etax_table table_border_red" summary="계산서">
                                    <tbody id="InvoiceList">
                                        <colgroup>
                                            <col span="50" style="width: 1%;">
                                            <col span="50" style="width: 1%;">
                                        </colgroup>
                                        <tr>
                                            <th class="al_c invoicer_bg" colspan="3" rowspan="6"><span class="bold lh_16">공<br>급<br>받<br>는<br>자</span></th>
                                            <input type="hidden" id="InvoiceeID" name="InvoiceeID">
                                            <th class="al_c bold" colspan="8">등록번호</th>
                                            <td class="al_l pdl_3" colspan="23"><input style="width: 80%; margin-right: 5px;" class="in_txt numeric al_c letspc_0" maxlength="12" type="text" id="InvoiceeCorpNum" name="InvoiceeCorpNum" placeholder="입력 후 엔터">
                                                <button class="btn_white_gradient mgl_2" id="btnSelectInvoicee" type="button">검색</button>
                                            </td>

                                            <th class="al_c" colspan="8">종사업장</th>
                                            <td class="al_l pdl_3" colspan="8"><input class="in_txt numeric letspc_0" maxlength="4" type="text" id="InvoiceeTaxRegID" name="InvoiceeTaxRegID"></td>

                                            <th class="al_c bold" colspan="8">작성일자</th>
                                            <td class="al_l pdl_3" colspan="17">
                                                <input type="date" id="writeDate" name="writeDate" class="in_txt numeric al_c dp-applied" maxlength="10" style="width: 190px; padding: 0 14px 0 5px;">
                                            </td>

                                            <th class="al_c" colspan="8">작성 방법</th>
                                            <td class="al_l pdl_3" colspan="17">
                                                <select class="in_txt" id="WriteTypeSelect" name="WriteTypeSelect" style="width:190px; line-height:1;">

                                                </select>
                                                <button id="totalAmountAct" type="button" class="btn_white_gradient" style="display: none;">계산 창 열기</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="al_c bold" colspan="8"><span>상호</span></th>
                                            <td class="al_l pdl_3" colspan="23"><textarea type="text" class="txt_ar kr" maxlength="200" id="InvoiceeCorpName" name="InvoiceeCorpName"></textarea></td>
                                            <th class="al_c bold lh_14" colspan="4"><p>성명</p></th>
                                            <td class="al_l pdl_3" colspan="12"><textarea type="text" class="txt_ar kr" maxlength="100" id="InvoiceeCEOName" name="InvoiceeCEOName"></textarea></td>


                                            <th class="al_c bold" colspan="8"><span>매출구분</span></th>
                                            <td class="al_l pdl_3" colspan="17">
                                                <select class="in_txt" id="sale_type" name="sale_type" style="width:190px; line-height:1;"></select>
                                            </td>
                                            <th class="al_c bold lh_14" colspan="8">발행구분</th>
                                            <td class="al_l pdl_3" colspan="17">
                                                <select class="in_txt" id="issue_div" name="issue_div" style="width:190px; line-height:1;"></select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="al_c  lh_14" colspan="8"><p><span>사업장</span></p><p><span>주소</span></p></th>
                                            <td class="al_l pdl_3" colspan="39"><textarea type="text" class="txt_ar kr" maxlength="300" id="InvoiceeAddr" name="InvoiceeAddr"></textarea></td>

                                            <th class="al_c bold" colspan="8"><span>계정코드</span></th>
                                            <td class="al_l pdl_3" colspan="17">
                                                <input style="width: 74%; margin-right: 5px;" class="in_txt numeric letspc_0" maxlength="12" type="text" id="account_code" name="account_code" placeholder="입력 후 엔터">
                                                <input type="hidden" id="account_codeHidden" name="account_codeHidden">
                                                <button class="btn_white_gradient mgl_2" id="btnSelectaccount_code" type="button">검색</button>
                                            </td>
                                            <th class="al_c bold" colspan="8"><span>귀속부서</span></th>
                                            <td class="al_l pdl_3" colspan="17">
                                                <input style="width: 74%; margin-right: 5px;" class="in_txt numeric letspc_0" maxlength="12" type="text" id="att_depart" name="att_depart" placeholder="입력 후 엔터">
                                                <input type="hidden" id="att_departHidden" name="att_departHidden">
                                                <button class="btn_white_gradient mgl_2" id="btnSelectatt_depart" type="button">검색</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="al_c" colspan="8"><span>업태</span></th>
                                            <td class="al_l pdl_3" colspan="17"><input type="text" class="txt_ar kr" maxlength="100" id="InvoiceeBizType" name="InvoiceeBizType"></td>
                                            <th class="al_c lh_14" colspan="4"><p>종목</p></th>
                                            <td class="al_l pdl_3" colspan="18"><input type="text" class="txt_ar kr" maxlength="100" id="InvoiceeBizClass" name="InvoiceeBizClass"></td>

                                            <th class="al_c bold" colspan="8"><span>프로젝트</span></th>
                                            <td class="al_l pdl_3" colspan="17">
                                                <input style="width: 74%; margin-right: 5px;" class="in_txt numeric letspc_0" maxlength="12" type="text" id="project" name="project" placeholder="입력 후 엔터">
                                                <input type="hidden" id="projectHidden" name="projectHidden">
                                                <button class="btn_white_gradient mgl_2" id="btnSelect_project" type="button">검색</button>
                                            </td>
                                            <th class="al_c bold lh_14" colspan="8">발행목적</th>
                                            <td class="al_l pdl_3" colspan="17">
                                                <select class="in_txt" id="purpose_type" name="purpose_type" style="width:190px; line-height:1;">
                                                    <option value="영수">영수</option>
                                                    <option value="청구">청구</option>
                                                    <option value="없음">없음</option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="al_c" colspan="8"><span>담당자</span></th>
                                            <td class="al_l pdl_3" colspan="17"><input class="in_txt kr" maxlength="100"  type="text" id="InvoiceeContactName1" name="InvoiceeContactName1" ></td>
                                            <th class="al_c" colspan="6">연락처</th>
                                            <td class="al_l pdl_3" colspan="16"><input class="in_txt numeric" maxlength="20" type="text" id="InvoiceeTEL1" name="InvoiceeTEL1" ></td>

                                            <th class="al_c pet0 gray_border_l" colspan="8"><span class="bold">공급가액</span></th>
                                            <td class="al_l pet0 pdl_3 gray_border_t gray_border_l" colspan="17"><input class="in_txt readonly al_r" maxlength="22" readonly="readonly" type="text" id="SupplyCostTotal" name="SupplyCostTotal" ></td>
                                            <th class="al_c pet1 gray_border_l tax-related" colspan="8"><span class="bold">세액</span></th>
                                            <td class="al_l pet1 pdl_3 gray_border_t gray_border_l tax-related" colspan="17"><input class="in_txt readonly al_r" maxlength="22" readonly="readonly" type="text" id="TaxTotal" name="TaxTotal" ></td>

                                        </tr>
                                        <tr>
                                            <th class="al_c" colspan="8"><span>이메일</span></th>
                                            <td class="al_l pdl_3" colspan="39">
                                                <input style="width: 83%;" class="in_txt en" maxlength="100" type="text" id="InvoiceeEmail1" name="InvoiceeEmail1" >
                                                <button class="btn_white_gradient mgl_2" id="saveInvoicee" type="button">정보 저장</button>
                                            </td>

                                            <th class="al_c" colspan="8"><span class="bold">합계금액</span></th>
                                            <td class="al_l pdl_3" colspan="42"><input class="in_txt readonly al_r" maxlength="22" readonly="readonly" type="text" id="TotalAmount" name="TotalAmount" ></td>

                                        </tr>
                                    </tbody>

                                    <tbody id="remarkList">
                                        <tr>
                                            <th class="splitline noborder_t" colspan="50"></th>
                                            <th class="splitline noborder_t" colspan="50"></th>
                                        </tr>
                                        <tr>
                                            <th class="al_c noborder_l" colspan="11"><span class="bold">비고1</span></th>
                                            <td class="al_l pdl_3 gray_border_l" colspan="85"><input class="in_txt kr" maxlength="150" type="text" id="Remark1" name="Remark1" ></td>
                                            <td class="al_c item_l_border gray_border_l" colspan="4">
                                                <a class="btn in_btn plus" title="추가" id="addRemark">
                                                    <img src="/images/icon/ico-plus.svg" alt="등록 아이콘">
                                                </a>
                                            </td>
                                        </tr>
                                        <tr id="remark2" class="none">
                                            <th class="al_c noborder_l gray_border_t" colspan="11"><span class="bold">비고2</span></th>
                                            <td class="al_l pdl_3 gray_border_l gray_border_t" colspan="85"><input class="in_txt kr" maxlength="150" type="text" id="Remark2" name="Remark2" ></td>
                                            <td class="al_c item_l_border gray_border_l gray_border_t" colspan="4">
                                                <a class="btn in_btn plus" title="삭제" id="removeRemark2">
                                                    <img src="/images/icon/ico-delete.svg" alt="삭제 아이콘">
                                                </a>
                                            </td>
                                        </tr>
                                        <tr id="remark3" class="none">
                                            <th class="al_c noborder_l gray_border_t" colspan="11"><span class="bold">비고3</span></th>
                                            <td class="al_l pdl_3 gray_border_l gray_border_t" colspan="85"><input class="in_txt kr" maxlength="150" type="text" id="Remark3" name="Remark3" ></td>
                                            <td class="al_c item_l_border gray_border_l gray_border_t" colspan="4">
                                                <a class="btn in_btn plus" title="삭제" id="removeRemark3">
                                                    <img src="/images/icon/ico-delete.svg" alt="삭제 아이콘">
                                                </a>
                                            </td>
                                        </tr>
                                    </tbody>

                                    <tbody id="taxList">

                                        <tr>
                                            <th class="al_c noborder_l" colspan="4"><span class="bold">월</span></th>
                                            <th class="al_c item_l_border" colspan="4"><span class="bold">일</span></th>
                                            <th class="al_c item_l_border" colspan="24"><span class="bold">품목</span></th>
                                            <th class="al_c item_l_border" colspan="14"><span class="bold">규격</span></th>
                                            <th class="al_c pet2 item_l_border" colspan="8"><span class="bold">수량</span></th>
                                            <th class="al_c pet3 item_l_border" colspan="8"><span class="bold">단가</span></th>
                                            <th class="al_c pet4 item_l_border" colspan="12"><span class="bold">공급가액</span></th>
                                            <th class="al_c pet5 item_l_border tax-related" colspan="10"><span class="bold">세액</span></th>
                                            <th class="al_c item_l_border" colspan="12"><span class="bold">비고</span></th>
                                            <th class="al_c item_l_border" colspan="4">
                                                <a class="btn in_btn plus" title="추가" id="btnAddFiveDetails">
                                                    <img src="/images/icon/ico-plus.svg" alt="등록 아이콘">
                                                </a>
                                            </th>
                                        </tr>
                                        <tr id="item_0">
                                            <td class="al_l pdl_3 noborder_l item_t_border" colspan="4">
                                                <input type="hidden" id="detailList0.SerialNum" name="detailList[0].SerialNum" >
                                                <input type="hidden" id="detailList0.PurchaseDT" name="detailList[0].PurchaseDT" >
                                                <input class="in_txt numeric al_c in_detail" maxlength="2" type="text" id="detailList0.PurchaseDT1" name="detailList[0].PurchaseDT1">
                                            </td>
                                            <td class="al_l pdl_3 item_border" colspan="4">
                                                <input class="in_txt numeric al_c in_detail" maxlength="2" type="text" id="detailList0.PurchaseDT2" name="detailList[0].PurchaseDT2">
                                            </td>
                                            <td class="al_l pdl_3 item_border" colspan="24">
                                                <div class="align-center-wrap">
                                                    <input type="hidden" id="detailList0.ItemId" name="detailList[0].ItemId">
                                                    <textarea class="txt_ar" style="width: 88%; margin-right: 3px;" maxlength="100" id="detailList0.ItemName" name="detailList[0].ItemName"></textarea>
                                                    <a class="btn in_btn" title="검색" id="btnViewItem_0">
                                                        <img src="/images/icon/btn-srch-black.svg" alt="검색 아이콘">
                                                    </a>
                                                </div>
                                            </td>
                                            <td class="al_l pdl_3 item_border" colspan="14"><textarea class="txt_ar" maxlength="60" id="detailList0.Spec" name="detailList[0].Spec"></textarea></td>
                                            <td class="al_l pdl_3 item_border pet2" colspan="8"><input class="in_txt numeric number al_r in_detail" maxlength="16" type="text" id="detailList0.Qty" name="detailList[0].Qty" ></td>
                                            <td class="al_l pdl_3 item_border pet3" colspan="8"><input class="in_txt numeric number al_r in_detail" maxlength="22" type="text" id="detailList0.UnitCost" name="detailList[0].UnitCost" ></td>
                                            <td class="al_l pdl_3 item_border pet4" colspan="12"><input class="in_txt numeric money al_r in_detail" maxlength="22" type="text" id="detailList0.SupplyCost" name="detailList[0].SupplyCost" ></td>
                                            <td class="al_l pdl_3 item_border pet5 tax-related" colspan="10"><input class="in_txt numeric money al_r in_detail" maxlength="22" type="text" id="detailList0.Tax" name="detailList[0].Tax" ></td>
                                            <td class="al_l pdl_3 item_border" colspan="12"><textarea class="txt_ar" maxlength="100" id="detailList0.Remark" name="detailList[0].Remark"></textarea></td>
                                            <td class="al_c item_border" colspan="4">
                                                <a class="btn in_btn" title="삭제" id="btnDelItem_0">
                                                    <img src="/images/icon/ico-delete.svg" alt="삭제 아이콘">
                                                </a>
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tbody id="resultList">
                                        <tr>
                                            <th class="splitline noborder_t" colspan="50"></th>
                                            <th class="splitline noborder_t" colspan="50"></th>
                                        </tr>
                                        <tr>
                                            <th class="al_c" colspan="11"><span class="bold">국세청 승인 번호</span></th>
                                            <td style="padding:0; padding-left:10px;" colspan="30">
                                                <div type="text" id="ntscfnum" name="ntscfnum" readonly></div>
                                            </td>
                                            <th class="al_c" colspan="15"><span class="bold">원본 국세청 승인 번호</span></th>
                                            <td style="padding:0; padding-left:10px;" colspan="25">
                                                <div type="text" id="orgntscfnum" name="orgntscfnum" readonly></div>
                                            </td>
                                            <th class="al_c" colspan="11"><span class="bold">수정 사유</span></th>
                                            <td style="padding:0; padding-left:10px;" colspan="30">
                                                <div type="text" id="modify_name" name="modify_name" readonly></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="al_c" colspan="11"><span class="bold">국세청 전송 결과</span></th>
                                            <td style="padding:0; padding-left:10px;" colspan="89">
                                                <div type="text" id="ntscode_des" name="ntscode_des" readonly></div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                </form>


            <div class="popup-button">
                <button type="button" class="btn-popup" id="btnInvoiceNew" ><span data-commonCd="신규">신규</span></button>
                <button type="button" class="btn-popup" id="btnInvoiceSave" ><span data-commonCd="저장">저장</span></button>
                <button type="button" class="btn-popup" id="btnEdit" style="display:none;"><span data-commonCd="수정 계산서 작성">수정 계산서 작성</span></button>
                <button type="button" class="btn-popup" id="btnReSave" style="display:none;"><span data-commonCd="다시 저장">다시 저장</span></button> <!-- 상태가 실패 했을때 다시 저장하는 저장 -->
                <button type="button" class="btn-popup" id="btnDelete" style="display:none;"><span data-commonCd="삭제">삭제</span></button>
                <button type="button" class="btn-popup" id="btnIssueCancel" style="display:none;"><span data-commonCd="발행 취소">발행 취소</span></button>
                <button type="button" class="btn-popup" id="btnReMessage" style="display:none;"><span data-commonCd="재전송">재전송</span></button>
                <button type="button" class="btn-popup" id="modal-close-button"><span data-commonCd="닫기">닫기</span></button>
            </div>


        </div>
    </script>

    <script type="text/javascript">

        class PopInvoiceComponent {
            constructor() {

            }

            initAfterOpen() {
                const taxType = $('input[name="TaxType"]:checked').val();
                setTaxTypeLayout(taxType);
            }
        }


        $(document).on('change', 'input[name="TaxType"]', function () {
            const taxType = $(this).val(); // 과세 / 영세 / 면세
            setTaxTypeLayout(taxType);
        });

        function setTaxTypeLayout(taxType) {
            const $writeTypeSelect = $('#WriteTypeSelect');
            console.log('setTaxTypeLayout $writeTypeSelect', $writeTypeSelect);
            if (taxType === '영세') {
                $('.tax-related').show();
                $writeTypeSelect.html(`
                    <option value="직접입력">직접입력</option>
                    <option value="수량단가">수량단가</option>
                `).val('직접입력').prop('disabled', false).trigger('change');

                $('input[id$=".Tax"]').attr('readonly', true);
                updateTaxLayout('과세'); // 영세지만 세액 칸은 유지

            } else if (taxType === '면세') {
                $('input[id$=".Tax"]').attr('readonly', true);
                $writeTypeSelect.html(`
                    <option value="직접입력">직접입력</option>
                    <option value="수량단가">수량단가</option>
                `).val('직접입력').prop('disabled', false).trigger('change');
                updateTaxLayout('면세'); // 세액 숨기고 colspan 수정

            } else if (taxType === '과세'){
                $('input[id$=".Tax"]').removeAttr('readonly');
                updateTaxLayout('과세');

                $writeTypeSelect.html(`
                    <option value="부가세 별도">부가세 별도</option>
                    <option value="부가세 포함">부가세 포함</option>
                    <option value="합계금액">합계금액</option>
                `).val('부가세 별도').prop('disabled', false).trigger('change');

            }

            updateWriteTypeBehavior($writeTypeSelect.val());
            recalculateTaxesIfNeeded();
        }

        function updateWriteTypeBehavior(writeType) {
            const $supplyCostInputs = $('#taxList').find('input[id$="SupplyCost"]');
            const $taxInputs = $('#taxList').find('input[id$="Tax"]');

            if (writeType === '부가세 포함') {
                $supplyCostInputs.prop('readonly', true);
                $taxInputs.prop('readonly', true);
            } else if (writeType === '수량단가') {
                $supplyCostInputs.prop('readonly', true);
                $taxInputs.prop('readonly', true);
            } else if (writeType === '직접입력') {
                $supplyCostInputs.prop('readonly', false);
                $taxInputs.prop('readonly', true); // 영세, 면세 기준
            } else {
                $supplyCostInputs.prop('readonly', false);
                $taxInputs.prop('readonly', false);
            }
        }

        $(document).on('change', '#WriteTypeSelect', function () {
            const writeType = $(this).val();
            updateWriteTypeBehavior(writeType);

            if (writeType === '합계금액') {
                $('#WriteTypeSelect').css('width', '100px');
                $('#totalAmountAct').show();
            } else {
                $('#WriteTypeSelect').css('width', '100%');
                $('#totalAmountAct').hide();
            }
        });

        $(document).on('change', 'input[name="InvoiceeType"]', function () {
            const taxType = $(this).val();
            const $corpNum = $('#InvoiceeCorpNum');

            if (taxType === '개인'){
                clearInvoiceeFields();
                $('#InvoiceeCorpNum')
                    .removeAttr('readonly')
                    .css('width', '80%');

                if (!window.__skipCorpNumReset) {
                    $corpNum.val('');
                }
                $('#btnSelectInvoicee').show();
                $('#InvoiceeTaxRegID').attr('readonly', true);
                $('#InvoiceeCEOName').attr('readonly', true);
                $('#InvoiceeBizType').attr('readonly', true);
                $('#InvoiceeBizClass').attr('readonly', true);
                $('#InvoiceeContactName1').attr('readonly', true);
                $('#InvoiceeEmail1')
                    .css('width', '80%');
                $('#saveInvoicee').show();

                $('#InvoiceeCorpName').off('input._autoFill').on('input._autoFill', function () {
                    const name = $(this).val();
                    $('#InvoiceeCEOName').val(name);
                    $('#InvoiceeContactName1').val(name);
                });


            } else if (taxType === '외국인') {
                clearInvoiceeFields();
                $('#InvoiceeCorpNum')
                    .attr('readonly', true)
                    .css('width', '100%')
                    .val("999999-9999999");
                $('#btnSelectInvoicee').hide();
                $('#InvoiceeTaxRegID').attr('readonly', true);
                $('#InvoiceeCEOName').attr('readonly', true);
                $('#InvoiceeBizType').attr('readonly', true);
                $('#InvoiceeBizClass').attr('readonly', true);
                $('#InvoiceeContactName1').attr('readonly', true);
                $('#InvoiceeEmail1')
                    .css('width', '100%');
                $('#saveInvoicee').hide();
                Alert.alert('', '외국인 등록번호 또는 여권번호를 [비고1]에 입력하여 주시기 바랍니다.');

                $('#InvoiceeCorpName').off('input._autoFill').on('input._autoFill', function () {
                    const name = $(this).val();
                    $('#InvoiceeCEOName').val(name);
                    $('#InvoiceeContactName1').val(name);
                });
            } else if (taxType === '사업자') {
                clearInvoiceeFields();
                $('#InvoiceeCorpNum')
                    .css('width', '80%')
                    .removeAttr('readonly');

                if (!window.__skipCorpNumReset) {
                    $corpNum.val('');
                }
                $('#btnSelectInvoicee').show();
                $('#InvoiceeTaxRegID').removeAttr('readonly');
                $('#InvoiceeCEOName').removeAttr('readonly');
                $('#InvoiceeBizType').removeAttr('readonly');
                $('#InvoiceeBizClass').removeAttr('readonly');
                $('#InvoiceeContactName1').removeAttr('readonly');
                $('#InvoiceeEmail1')
                    .css('width', '80%');
                $('#saveInvoicee').show();
                $('#InvoiceeCorpName').off('input._autoFill');
            }
            window.__skipCorpNumReset = false;
        });

        function clearInvoiceeFields() {
            if (!window.__skipInvoiceeFieldReset) {
                const fields = [
                    'InvoiceeID', 'InvoiceeCorpNum', 'InvoiceeTaxRegID',
                    'InvoiceeCorpName', 'InvoiceeCEOName', 'InvoiceeAddr',
                    'InvoiceeBizType', 'InvoiceeBizClass', 'InvoiceeContactName1',
                    'InvoiceeTEL1', 'InvoiceeEmail1'
                ];
                fields.forEach(id => $('#' + id).val(''));
            }

        }

        $(document).on('change', 'input[name="WriteType"]', function () {
            const taxType = $(this).val();

            if (taxType === '부가세 별도') {
                $('#taxList').find('input[id$="SupplyCost"], input[id$="Tax"]').prop('readonly', false);
            } else if (taxType === '부가세 포함') {
                $('#taxList').find('input[id$="SupplyCost"], input[id$="Tax"]').prop('readonly', true);
            } else if (taxType === '합계금액'){
                $('#taxList').find('input[id$="SupplyCost"], input[id$="Tax"]').prop('readonly', false);
            }
        });


        function updateTaxLayout(taxType) {
            const showTax = taxType === '과세'; // or taxType !== '면세'

            if (!showTax) {
                // 1. 세액 관련 요소 숨김
                $('.tax-related').hide();

                // 2. 공급가액 colspan 확장 (세액 사라짐으로 해당 공간 차지)
                $('td.pet0').attr('colspan', 42); // 기존 17 + 17

                $('th[colspan="12"].pet4, td[colspan="12"].pet4').attr('colspan', 22);

            } else {
                // 1. 세액 관련 요소 보임
                $('.tax-related').show();

                $('th.pet4, td.pet4').attr('colspan', 12);

                // 2. 공급가액 colspan 복구
                $('th.pet0').attr('colspan', 8);

                $('td.pet0').attr('colspan', 17);

            }
        }

        $(document).on('click', '#addRemark', function () {
            if ($('#remark2').is(':hidden')) {
                $('#remark2').removeClass('none');
            } else if ($('#remark3').is(':hidden')) {
                $('#remark3').removeClass('none');
            } else {
                Alert.alert('', '비고는 3개까지 추가할 수 있습니다.');
            }
        });

        $(document).on('click', '#removeRemark2', function () {
            if (!$('#remark3').hasClass('none')) {
                $('#remark3').addClass('none');
                $('#Remark3').val('');
            } else if (!$('#remark2').hasClass('none')) {
                $('#remark2').addClass('none');
                $('#Remark2').val('');
            }
        });

        $(document).on('click', '#removeRemark3', function () {
            $('#remark3').addClass('none');
            $('#Remark3').val('');
        });

        let detailRowCount = 0; // 현재 detail 행의 개수 (전역)

        // 품목 행 디폴트
        function initializeDetailRows(data = []) {
            console.log('initializeDetailRows', data);
            const $originRow = $('#item_0');
            const rowCount = Math.max(data.length, 4);

            for (let i = 0; i < rowCount; i++) {
                let $newRow = $originRow.clone();
                $newRow.attr('id', 'item_' + i);

                $newRow.find('input, textarea, a').each(function () {
                    const $this = $(this);
                    const oldId = $this.attr('id');
                    const oldName = $this.attr('name');

                    if (oldId) {
                        let newId = oldId.replace(/detailList\d+/g, 'detailList' + i)
                            .replace(/btnViewItem_\d+/g, 'btnViewItem_' + i)
                            .replace(/btnDelItem_\d+/g, 'btnDelItem_' + i);
                        $this.attr('id', newId);
                    }

                    if (oldName) {
                        const newName = oldName.replace(/detailList\[\d+\]/g, 'detailList[' + i + ']');
                        $this.attr('name', newName);
                    }

                    if ($this.is('input[type="text"], input[type="hidden"], textarea') && data[i]) {
                        const match = $this.attr('name')?.match(/detailList\[\d+\]\.(\w+)/);
                        const field = match?.[1];
                        if (field && data[i]?.[field] !== undefined) {
                            $this.val(data[i][field]);
                        } else {
                            $this.val('');
                        }
                    }
                });

                $newRow.find('input[id$=".SerialNum"]').val(i + 1);

                if (i === 0) {
                    $originRow.replaceWith($newRow);
                } else {
                    $('#item_' + (i - 1)).after($newRow);
                }
            }
            updateTotals();
            detailRowCount = rowCount;
        }

        // 품목행 추가 버튼
        $(document).on('click', '#btnAddFiveDetails', function () {
            addFiveDetails();
        });

        // 품목행 삭제 버튼
        $(document).on('click', 'a[id^="btnDelItem_"]', function () {
            const $row = $(this).closest('tr');

            // 현재 남아있는 줄 개수
            const currentRowCount = $('tr[id^="item_"]').length;

            if (currentRowCount <= 4) {
                $row.find('input, textarea').each(function () {
                    $(this).val('');
                });
                updateTotals();
                return;
            }

            // 삭제하고
            $row.remove();

            // 삭제 후 재정렬
            reindexDetailRows();

            // 계산 다시
            updateTotals();
        });

        // 품목 5번째 행부터 추가
        function addFiveDetails() {
            let currentRowCount = $('tr[id^="item_"]').length;

            for (let i = 0; i < 5; i++) {
                const $originRow = $('#item_0');
                let $newRow = $originRow.clone();

                let newIndex = currentRowCount + i;

                $newRow.attr('id', 'item_' + newIndex);

                $newRow.find('input, textarea, a').each(function () {
                    const $this = $(this);
                    const oldId = $this.attr('id');
                    const oldName = $this.attr('name');

                    if (oldId) {
                        let newId = oldId.replace(/detailList\d+/g, 'detailList' + newIndex)
                            .replace(/btnViewItem_\d+/g, 'btnViewItem_' + newIndex)
                            .replace(/btnDelItem_\d+/g, 'btnDelItem_' + newIndex);
                        $this.attr('id', newId);
                    }
                    if (oldName) {
                        const newName = oldName.replace(/detailList\[\d+\]/g, 'detailList[' + newIndex + ']');
                        $this.attr('name', newName);
                    }
                    if ($this.is('input[type="text"], input[type="hidden"], textarea')) {
                        $this.val('');
                    }
                });

                $('tr[id^="item_"]').last().after($newRow);
            }

            reindexDetailRows(); // 추가 후 항상 정렬
        }


        // 품목행 인덱스 재정렬
        function reindexDetailRows() {
            $('tr[id^="item_"]').each(function (index) {
                const $row = $(this);

                // 행 id 수정
                $row.attr('id', 'item_' + index);

                $row.find('input, textarea, a').each(function () {
                    const $this = $(this);
                    const oldId = $this.attr('id');
                    const oldName = $this.attr('name');

                    if (oldId) {
                        let newId = oldId.replace(/detailList\d+/g, 'detailList' + index)
                            .replace(/btnViewItem_\d+/g, 'btnViewItem_' + index)
                            .replace(/btnDelItem_\d+/g, 'btnDelItem_' + index);
                        $this.attr('id', newId);
                    }
                    if (oldName) {
                        const newName = oldName.replace(/detailList\[\d+\]/g, 'detailList[' + index + ']');
                        $this.attr('name', newName);
                    }
                });

                // **SerialNum은 tr 순서대로 index + 1**
                $row.find('input[id$=".SerialNum"]').val(index + 1);
            });

            detailRowCount = $('tr[id^="item_"]').length;
        }


        // 총합계 계산 (공급가액 + 세액)
        function updateTotals() {
            console.log('updateTotals');
            let supplyCostSum = 0;
            let taxSum = 0;

            $('input[id$=".SupplyCost"]').each(function () {
                const val = parseFloat($(this).val().replace(/,/g, '')) || 0;
                supplyCostSum += val;
            });

            $('input[id$=".Tax"]').each(function () {
                const val = parseFloat($(this).val().replace(/,/g, '')) || 0;
                taxSum += val;
            });

            $('#SupplyCostTotal').val(supplyCostSum.toLocaleString());
            $('#TaxTotal').val(taxSum.toLocaleString());
            $('#TotalAmount').val((supplyCostSum + taxSum).toLocaleString());
        }


        function recalculateTaxesForRow($row) {
            console.log('recalculateTaxesForRow');
            const taxMode = $('input[name="TaxType"]:checked').val();       // 과세 / 영세 / 면세
            const writeType = $('#WriteTypeSelect').val();   // 단가 유형

            const $qty = $row.find('input[id$="Qty"]');
            const $unitCost = $row.find('input[id$="UnitCost"]');
            const $supplyCost = $row.find('input[id$="SupplyCost"]');
            const $tax = $row.find('input[id$="Tax"]');

            let qty = parseFloat($qty.val().replace(/,/g, '').trim()) || 0;
            let unitCost = parseFloat($unitCost.val().replace(/,/g, '').trim()) || 0;

            if (qty > 0 && unitCost > 0) {
                let supplyCost = 0;
                let tax = 0;

                if (writeType === '부가세 포함' && taxMode === '과세') {
                    const total = qty * unitCost;
                    const supply = total / 1.1;
                    supplyCost = Math.floor(supply);
                    tax = total - supplyCost;
                } else {
                    supplyCost = qty * unitCost;
                    tax = (taxMode === '과세') ? Math.floor(supplyCost * 0.1) : 0;
                }

                $supplyCost.val(supplyCost.toLocaleString());
                $tax.val(tax.toLocaleString());
            }
        }


        function recalculateTaxesIfNeeded() {
            console.log('recalculateTaxesIfNeeded');
            const taxType = $('input[name="TaxType"]:checked').val();

            let index = 0;
            while (true) {
                const $supplyCost = $('#detailList' + index + '\\.SupplyCost');
                const $tax = $('#detailList' + index + '\\.Tax');

                if ($supplyCost.length === 0 || $tax.length === 0) break;

                let supplyCostVal = $supplyCost.val().replace(/,/g, '').trim();
                let supplyCost = parseFloat(supplyCostVal) || 0;

                if (supplyCost > 0) {
                    if (taxType === '영세' || taxType === '면세') {
                        $tax.val('0');
                    } else if (taxType === '과세') {
                        let tax = Math.round(supplyCost * 0.1);
                        $tax.val(tax.toLocaleString());
                    }
                }

                index++;
            }

            updateTotals();
        }

        // "합계금액" 선택
        $(document).on('change', '#WriteTypeSelect', function () {
            console.log('WriteTypeSelect');
            const writeType = $(this).val();
            updateWriteTypeBehavior(writeType);

            if (writeType === '합계금액') {
                openPopup(); // 기존에 사용하던 모달 여는 함수
            }
        });

        // "계산 창 열기" 버튼 클릭
        $(document).on('click', '#totalAmountAct', function (event) {
            console.log('totalAmountAct');
            event.stopPropagation(); // 이벤트 버블링 막기
            openPopup();
        });

        function openPopup() {
            console.log('openPopup');
            let poppage = new PopTotalAmountComponent();
            console.log(typeof PopTotalAmountComponent);
            let searchcallback = function (items) {
                let index = 0;
                while (true) {
                    let $supplyCost = $(document).find('#detailList' + index + '\\.SupplyCost');
                    let $tax = $(document).find('#detailList' + index + '\\.Tax');

                    // 없으면 반복 종료
                    if ($supplyCost.length === 0 || $tax.length === 0) {
                        break;
                    }

                    // 비어있는 행 찾기
                    if ($supplyCost.val().trim() === '' && $tax.val().trim() === '') {
                        $supplyCost.val(items.supplyCost.toLocaleString());
                        $tax.val(items.tax.toLocaleString());

                        const $row = $supplyCost.closest('tr');
                        recalculateTaxesForRow($row);
                        updateTotals();

                        break; // 입력했으면 멈춘다
                    }


                    index++;
                }

            };

            poppage.show(searchcallback);
        }


        // 수량 또는 단가 입력 → 공급가 + 세액 계산
        $(document).on('input', '#taxList input[id$="Qty"], #taxList input[id$="UnitCost"]', function () {
            console.log('input\', \'#taxList input[id$="Qty"], #taxList input[id$="UnitCost"]');
            const $row = $(this).closest('tr');
            const $qty = $row.find('input[id$="Qty"]');
            const $unitCost = $row.find('input[id$="UnitCost"]');

            const qtyVal = $qty.val().replace(/,/g, '').trim();
            const unitCostVal = $unitCost.val().replace(/,/g, '').trim();

            if (qtyVal !== '' && unitCostVal !== '') {
                recalculateTaxesForRow($row);
                updateTotals();
            }
        });

        // 공급가 입력 → 세액 계산
        $(document).on('input', '#taxList input[id$="SupplyCost"]', function () {
            const $row = $(this).closest('tr');
            const taxMode = $('input[name="TaxType"]:checked').val();
            const $supplyCost = $row.find('input[id$="SupplyCost"]');
            const $tax = $row.find('input[id$="Tax"]');

            let supplyCost = parseFloat($supplyCost.val().replace(/,/g, '').trim()) || 0;
            let tax = taxMode === '과세' ? Math.floor(supplyCost * 0.1) : 0;

            $tax.val(tax.toLocaleString());
            updateTotals();
        });

        // 세액 직접 입력 시 → 합계 업데이트
        $(document).on('input', '#taxList input[id$="Tax"]', function () {
            updateTotals();
        });

        // 수량, 단가, 공급가액, 세액 필드 입력 시 숫자형으로 포맷팅 (천단위 콤마)
        $(document).on('input', '#taxList input[id$="Qty"], #taxList input[id$="UnitCost"], #taxList input[id$="SupplyCost"], #taxList input[id$="Tax"]', function () {
            console.log('수량, 단가, 공급가액, 세액 필드 입력 시 숫자형으로 포맷팅');
            let raw = $(this).val().replace(/,/g, ''); // 기존 콤마 제거
            if (raw.length > 0 && !isNaN(raw)) {
                $(this).val(Number(raw).toLocaleString()); // 숫자면 콤마 다시 붙이기
            }
        });

        // 사업자번호 또는 주민등록번호 입력 시 자동 포맷 적용
        $(document).on('input', '#InvoicerCorpNum, #InvoiceeCorpNum', function () {
            const isInvoicee = $(this).attr('id') === 'InvoiceeCorpNum';
            const invoiceeType = $('input[name="InvoiceeType"]:checked').val(); // 라디오 버튼일 경우

            let rawValue = $(this).val();

            if (isInvoicee && (invoiceeType === '개인' || invoiceeType === '외국인')) {
                $(this).attr('maxlength', 14); // 주민등록번호는 총 14자리 (하이픈 포함)
                $(this).val(formatRRN(rawValue));
            } else {
                $(this).attr('maxlength', 12); // 사업자번호 최대 길이 (하이픈 포함)
                $(this).val(formatBizNum(rawValue));
            }
        });

        // 사업자등록번호 포맷팅 (###-##-#####)
        function formatBizNum(value) {
            value = value.replace(/[^0-9]/g, '').slice(0, 10);
            if (value.length > 3 && value.length <= 5) {
                return value.slice(0, 3) + '-' + value.slice(3);
            } else if (value.length > 5) {
                return value.slice(0, 3) + '-' + value.slice(3, 5) + '-' + value.slice(5);
            }
            return value;
        }

        function formatMaskedRRN(value) {
            value = value.replace(/[^0-9*]/g, '');

            if (value.length >= 7) {
                return value.replace(/^(\d{6})(\d+)/, '$1-$2');
            }

            return value;
        }

        // 주민등록번호 포맷팅 (######-#######)
        function formatRRN(value) {
            value = value.replace(/[^0-9]/g, '').slice(0, 13);
            if (value.length > 6) {
                return value.slice(0, 6) + '-' + value.slice(6);
            }
            return value;
        }


        // 전화번호 포맷팅 (지역번호 감지)
        function formatPhoneNumber(value) {
            value = value.replace(/[^0-9]/g, '');

            // 서울 지역번호 (02)
            if (value.startsWith('02')) {
                if (value.length > 2 && value.length <= 5) {
                    return value.slice(0, 2) + '-' + value.slice(2);
                } else if (value.length > 5 && value.length <= 9) {
                    return value.slice(0, 2) + '-' + value.slice(2, 5) + '-' + value.slice(5);
                } else if (value.length > 9) {
                    return value.slice(0, 2) + '-' + value.slice(2, 6) + '-' + value.slice(6, 10);
                }
            }

            // 나머지 지역번호 (031, 051, 010 등)
            if (value.length > 3 && value.length <= 6) {
                return value.slice(0, 3) + '-' + value.slice(3);
            } else if (value.length > 6 && value.length <= 10) {
                return value.slice(0, 3) + '-' + value.slice(3, 6) + '-' + value.slice(6);
            } else if (value.length > 10) {
                return value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
            }

            return value;
        }

        // 전화번호 입력 시 자동 포맷 적용
        $(document).on('input', '#InvoicerTEL, #InvoiceeTEL1', function () {
            $(this).val(formatPhoneNumber($(this).val()));
        });

        // 금액 입력 시 숫자만 허용 + 천단위 콤마 포맷 적용
        $(document).on('input', '#Cash, #ChkBill, #Note, #Credit', function () {
            let inputVal = $(this).val().replace(/[^0-9]/g, ''); // 숫자만 남김
            if (inputVal === '') {
                $(this).val('');
                return;
            }
            let formatted = Number(inputVal).toLocaleString('en-US'); // 천 단위 , 추가
            $(this).val(formatted);
        });

        // 계정코드 선택
        $(document).on('click', '#btnSelectaccount_code', function () {
            let poppage = new PopAccSubComponent();
            let searchcallback = function (items) {
                $(document).find('#account_code').val(items.accnm);
                $(document).find('#account_codeHidden').val(items.acccd);

            };

            poppage.show(searchcallback);
        });

        // 계정코드 선택
        $(document).on('keydown', '#account_code', function (e) {
            if (e.type === 'keydown' && e.key !== 'Enter' && e.keyCode !== 13) return;

            e.preventDefault();

            const keyword = $('#account_code').val().trim();
            const poppage = new PopAccSubComponent();

            const searchcallback = function (item) {
                $('#account_code').val(item.accnm);
                $('#account_codeHidden').val(item.acccd);
                setTimeout(() => {
                    // $('#btnSave').focus(); // 필요에 따라 포커스 위치 조정
                }, 0);
            };

            if (!keyword) {
                poppage.focusAfterClose = document.getElementById('account_code');
                poppage.show(searchcallback);
                return;
            }

            // 검색 조건
            const data = {
                srchCode: '',
                srchName: keyword,
                spjangcd: sessionStorage.getItem('spjangcd')
            };

            const result = AjaxUtil.getSyncData('/api/popup/search_acc_sub', data);
            const rows = result?.data || [];
            console.log('search_acc_sub data', data);
            console.log('search_acc_sub rows', rows);
            if (rows.length === 1) {
                searchcallback(rows[0]);
            } else {
                poppage.show(searchcallback);
                setTimeout(() => {
                    poppage.$srchName.val(keyword);
                    poppage.$btnSearch.trigger('click');
                }, 50);
            }
        });

        // 귀속부서
        $(document).on('keydown', '#att_depart', function (e) {
            if (e.type === 'keydown' && e.key !== 'Enter' && e.keyCode !== 13) return;

            e.preventDefault();

            const keyword = $('#att_depart').val().trim();
            const poppage = new PopDepartComponent();

            const searchcallback = function (item) {
                console.log('att_depart item', item);
                $('#att_depart').val(item.Name);
                $('#att_departHidden').val(item.Code);
                setTimeout(() => {
                    // $('#btnSave').focus(); // 필요에 따라 포커스 위치 조정
                }, 0);
            };

            if (!keyword) {
                poppage.focusAfterClose = document.getElementById('att_depart');
                poppage.show(searchcallback);
                return;
            }

            // 검색 조건
            const data = {
                srchCode: '',
                srchName: keyword,
                spjangcd: sessionStorage.getItem('spjangcd')
            };

            const result = AjaxUtil.getSyncData('/api/popup/search_depart', data);
            const rows = result?.data || [];

            if (rows.length === 1) {
                searchcallback(rows[0]);
            } else {
                poppage.show(searchcallback);
                setTimeout(() => {
                    poppage.$srchName.val(keyword);
                    poppage.$btnSearch.trigger('click');
                }, 50);
            }
        });


        // 귀속부서 선택
        $(document).on('click', '#btnSelectatt_depart', function () {
            let poppage = new PopDepartComponent();
            let searchcallback = function (items) {
                $(document).find('#att_depart').val(items.Name);
                $(document).find('#att_departHidden').val(items.Code);

            };

            poppage.show(searchcallback);
        });

        // 프로젝트
        $(document).on('keydown', '#project', function (e) {
            if (e.type === 'keydown' && e.key !== 'Enter' && e.keyCode !== 13) return;

            e.preventDefault();

            const keyword = $('#project').val().trim();
            const poppage = new PopProjectComponent();

            const searchcallback = function (item) {
                $('#project').val(item.projnm);
                $('#projectHidden').val(item.projno);
                setTimeout(() => {
                    // $('#btnSave').focus(); // 필요에 따라 포커스 위치 조정
                }, 0);
            };

            if (!keyword) {
                poppage.focusAfterClose = document.getElementById('project');
                poppage.show(searchcallback);
                return;
            }

            // 검색 조건
            const data = {
                srchCode: '',
                srchName: keyword,
                spjangcd: sessionStorage.getItem('spjangcd')
            };

            const result = AjaxUtil.getSyncData('/api/popup/search_project', data);
            const rows = result?.data || [];

            if (rows.length === 1) {
                searchcallback(rows[0]);
            } else {
                poppage.show(searchcallback);
                setTimeout(() => {
                    poppage.$srchName.val(keyword);
                    poppage.$btnSearch.trigger('click');
                }, 50);
            }
        });

        // 프로젝트 선택
        $(document).on('click', '#btnSelect_project', function () {
            let poppage = new PopProjectComponent();
            let searchcallback = function (items) {
                $(document).find('#project').val(items.projnm);
                $(document).find('#projectHidden').val(items.projno);

            };

            poppage.show(searchcallback);
        });

        // 이름 다 지우면 id 값도 빠짐
        $(document).on('input', '#account_code', function () {
            if ($(this).val().trim() === '') {
                $('#account_codeHidden').val('');
            }
        });

        $(document).on('input', '#att_depart', function () {
            if ($(this).val().trim() === '') {
                $('#att_departHidden').val('');
            }
        });

        $(document).on('input', '#project', function () {
            if ($(this).val().trim() === '') {
                $('#projectHidden').val('');
            }
        });

        $(document).on('input', 'textarea[id^="detailList"][id$=".ItemName"]', function () {
            const id = $(this).attr('id'); // ex: detailList0.ItemName
            const match = id.match(/^detailList(\d+)\.ItemName$/);

            if (match !== null) {
                const index = match[1];
                const itemIdSelector = 'input[id="detailList' + index + '.ItemId"]'; // 속성 선택자 방식

                if ($(this).val().trim() === '') {
                    $(itemIdSelector).val('');
                }
            }
        });


    </script>