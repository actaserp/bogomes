<html layout:decorate="~{layout_page}" xmlns:layout="http://www.w3.org/1999/xhtml">
<head>
    <style>
        .wj-header {
            text-align: center !important;
        }
    </style>
</head>

<th:block layout:fragment="content">
    <div class="layout-contents">
        <!-- Page Title -->
        <div class="page-title-wrap">
            <div class="left">
                <h2>거래구분관리</h2>
                <a title="북마크" class="bookmark toggle">
                    내메뉴
                </a>
            </div>
            <ul class="page-navi">
                <li><img src="/images/icon/ico-nav-home.svg" alt="홈아이콘"></li>
                <li>기준정보</li>
                <li>거래구분관리</li>
            </ul>
        </div>

        <section class="section">
            <div class="section-top">
                <div class="search-wrap">
                    <dl>
                        <dt>
                            <label>구분명</label>
                        </dt>
                        <dd>
                            <div class="srch-box">
                                <input type="text" class="form-control2" id="txtUnit" name="txtUnit">
                            </div>
                        </dd>
                    </dl>

                    <dl>
                        <dt>
                            <label>구분</label>
                        </dt>
                        <dd>
                            <div class="srch-box">
                                <select id="" name="">
                                    <option value="">전체</option>
                                    <option value="">입금</option>
                                    <option value="">출금</option>
                                </select>
                            </div>
                        </dd>
                    </dl>

                    <dl>
                        <dt><span class="eq"></span></dt>
                        <dd>
                            <li>
                                <a class="btn btn-delete" title="검색" id="btnSearch">
                                    <img src="/images/icon/btn-srch.svg" alt="검색 아이콘">
                                    검색
                                </a>
                            </li>
                        </dd>
                    </dl>
                </div>
            </div> <!--//section-top end -->
            <div class="container-fluid">
                <p id="selectedItem"></p>
                <div id="transaction-grid" style="height: 480px; max-height: 480px;"></div>
            </div>
            <div class="btn-wrap">
            </div>
        </section>

        <section>
            <div class="section-top">
                <div class="search-wrap">
                    <ul>
                        <li>
                            <button type="button" class="btn-default " id="btnNew2" name="btnNew"
                                    style="width: 115px; height: 36px;"><i
                                    class="fas fa-plus"></i>신규등록
                            </button>
                        </li>

                        <li>
                            <button type="button" class="btn-danger " id="btnDel2"
                                    style=" width: 115px; height: 36px;"><i
                                    class="fas fa-trash"></i>삭제</button>
                        </li>
                        <li>
                            <button type="button" class="btn-default" id="btnSave2"
                                    style="width: 115px; height: 36px;"><i
                                    class="fas fa-save"></i>저장</button>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="table-wrap">
                <form id="unitForm">
                    <table class="write-table" style="width: 100%">
                        <caption style="text-align: left; margin-bottom: 8px;">등록테이블</caption>
                        <input type="hidden" id="id" name="id"/>
                        <colgroup>
                            <col class="wp20">
                            <col class="wp30">
                            <col class="wp20">
                            <col class="wp30">
                        </colgroup>
                        <tbody>
                        <tr>
                            <th>
                                <label for="name"><span class="eq">*</span>거래구분명</label>
                            </th>
                            <td>
                                <input type="text" id="name" name="name" style="width: 100%">
                            </td>
                            <th>
                                <label for="piece_yn">입출구분</label>
                            </th>
                            <td>
                                <select type="text" id="piece_yn" name="pieceYN" style="width: 100%">
                                    <option value="">No</option>
                                    <option value="Y">Yes</option>
                                </select>
                            </td>
                        </tr>

                        <tr>
                            <th>
                                <label for="description">계정과목</label>
                            </th>
                            <td colspan="3">
                                <input type="text" id="description" name="description" style="width: 100%;">
                                <!--<textarea id="description" name="description"></textarea>-->
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </form>
            </div>
            <!--//tab-wrap end-->
        </section>
    </div> <!--//layout-contents end -->

    <footer style="margin-top: 24px;">
        <p>Copyrightⓒ 0000 corp. All rights reserved.</p>
    </footer>

</th:block>
<th:block layout:fragment="scripts">
    <script type="text/javascript">
        class TransactionPage {
            constructor() {
                this.grid = null;
                this.selectedPk = null;
                this.viewData = new wijmo.collections.CollectionView();
                this.baseUrl = '/api/support/excel_form';
                this.init();
            }

            init() {
                let _this = this;
                this.grid = new wijmo.grid.FlexGrid('#transaction-grid', {
                    selectionMode: wijmo.grid.SelectionMode.Row,
                    headersVisibility: wijmo.grid.HeadersVisibility.Column,
                    autoGenerateColumns: false,
                    showMarquee: true,
                    isReadOnly: true,
                    formatItem: (sender, e) => {
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            e.cell.style.textAlign = 'center';
                        }
                    },
                    columns: [
                        {binding: '', header: '코드', width: 200, align: 'left'},
                        {binding: '', header: '입/출구분', width: 250, align: 'center'},
                        {binding: '', header: '거래구분명', width: 200, align: 'center'},
                        {binding: '', header: '계정과목', width: 400, align: 'left'},
                        {binding: '', header: '', width: "*", align: 'left'},
                    ],
                    itemsSource: this.viewData, // 데이터를 설정할 배열
                });

                this.grid.hostElement.addEventListener('dblclick', (e) => {
                    let hitTest = this.grid.hitTest(e);
                    if (hitTest.cellType === wijmo.grid.CellType.Cell) {
                        let row = hitTest.row;
                        let item = this.grid.rows[row].dataItem;
                        _this.showEditPage(item.id,'edit');
                        //$("#stop_cause_name").val(item.stop_cause_name);
                        //$("#description").val(item.description);
                    }
                });

                new FlexGridContextMenu(this.grid);
                this.grid.downloadFileName = '거래구분';

            }

            // 버튼 활성화 설정
            /*setButtonState() {
                let _this = this;

                if (this.selectedPk) {
                    $('#btnEdit').removeAttr('disabled');
                    $('#btnDel').removeAttr('disabled');
                } else {
                    $('#btnEdit').attr('disabled', 'disabled');
                    $('#btnDel').attr('disabled', 'disabled');
                }
            }*/

            // 문서 목록 조회
            searchMainData() {
                let _this = this;
                /*let param = {
                    //'action': 'read',
                    'txtUnit': $('#txtUnit').val(),
                }*/

                let result = AjaxUtil.getSyncData(this.baseUrl + '/read');
                if (result.data != null) {
                    /*_this.viewData.sourceCollection = result.data;*/
                    /*this.setButtonState();*/
                }
            }

            // edit page로 전환
            showEditPage(idx,action) {
                let pk = '';
                let url = '';

                this.selectedPk = idx;

                if (action != 'new') {
                    pk = this.selectedPk;

                    if (!pk) {
                        Alert.alert('', '양식을 선택해주세요.');
                        return;
                    }
                }

                url = '/gui/' + gui.gui_code + '/edit?action=' + action + '&pk=' + pk;
                location.href = encodeURI(url);
            }
        }

        let page = null;

        $(document.body).ready(function (e) {
            page = new TransactionPage();

            page.searchMainData();

            //검색
            $('#btnSearch').click(function (e) {
                page.searchMainData();
            });

            $('#keyword').on('keypress', function (e) {
                if (event.keyCode == 13) {
                    page.searchMainData();
                }
            });

            // 신규
            $('#btnNew').click(function (e) {
                let id = null; // ID 값 가져오기
                page.showEditPage(id,'new')
            });

            // 수정
            $('#btnEdit').click(function (e) {
                let grid = wijmo.Control.getControl('#transaction-grid'); // 그리드 객체 가져오기
                let selection = grid.selection; // 현재 선택된 셀의 정보 가져오기

                if (selection.length == 0) {
                    Alert.alert('제품이 선택되지 않았습니다.');
                    return;
                }

                if (selection.row > -1) { // 선택된 행이 있을 경우
                    let item = grid.rows[selection.row].dataItem; // 선택된 행의 데이터 가져오기

                    if (item) {
                        let id = item.id; // ID 값 가져오기
                        page.showEditPage(id,'edit')
                    }
                }
            });

            // 삭제
            $('#btnDel').click(function (e) {
                page.showEditPage('del');
            });
        });
    </script>
</th:block>

</html>